"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _teen_process = require("teen_process");
var _logger = _interopRequireDefault(require("../logger.js"));
var _path = _interopRequireDefault(require("path"));
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _lruCache = _interopRequireDefault(require("lru-cache"));
var _helpers = require("../helpers.js");
var _asyncLock = _interopRequireDefault(require("async-lock"));
var _bluebird = _interopRequireDefault(require("bluebird"));
const BASE_APK = 'base-master.apk';
const LANGUAGE_APK = lang => `base-${lang}.apk`;
const APKS_CACHE = new _lruCache.default({
  max: 10,
  dispose: (apksHash, extractedFilesRoot) => _support.fs.rimraf(extractedFilesRoot)
});
const APKS_CACHE_GUARD = new _asyncLock.default();
const BUNDLETOOL_TIMEOUT_MS = 4 * 60 * 1000;
const apksUtilsMethods = {};
process.on('exit', () => {
  if (!APKS_CACHE.size) {
    return;
  }
  const paths = [...APKS_CACHE.values()];
  _logger.default.debug(`Performing cleanup of ${paths.length} cached .apks ` + _support.util.pluralize('package', paths.length));
  for (const appPath of paths) {
    try {
      _support.fs.rimrafSync(appPath);
    } catch (e) {
      _logger.default.warn(e.message);
    }
  }
});
async function extractFromApks(apks, dstPath) {
  if (!_lodash.default.isArray(dstPath)) {
    dstPath = [dstPath];
  }
  return await APKS_CACHE_GUARD.acquire(apks, async () => {
    const apksHash = await _support.fs.hash(apks);
    _logger.default.debug(`Calculated '${apks}' hash: ${apksHash}`);
    if (APKS_CACHE.has(apksHash)) {
      const resultPath = _path.default.resolve(APKS_CACHE.get(apksHash), ...dstPath);
      if (await _support.fs.exists(resultPath)) {
        return resultPath;
      }
      APKS_CACHE.del(apksHash);
    }
    const tmpRoot = await _support.tempDir.openDir();
    _logger.default.debug(`Unpacking application bundle at '${apks}' to '${tmpRoot}'`);
    await (0, _helpers.unzipFile)(apks, tmpRoot);
    const resultPath = _path.default.resolve(tmpRoot, ...dstPath);
    if (!(await _support.fs.exists(resultPath))) {
      throw new Error(`${dstPath.join(_path.default.sep)} cannot be found in '${apks}' bundle. ` + `Does the archive contain a valid application bundle?`);
    }
    APKS_CACHE.set(apksHash, tmpRoot);
    return resultPath;
  });
}
apksUtilsMethods.execBundletool = async function execBundletool(args, errorMsg) {
  await this.initBundletool();
  args = ['-jar', this.binaries.bundletool, ...args];
  const env = process.env;
  if (this.adbPort) {
    env.ANDROID_ADB_SERVER_PORT = `${this.adbPort}`;
  }
  if (this.adbHost) {
    env.ANDROID_ADB_SERVER_HOST = this.adbHost;
  }
  _logger.default.debug(`Executing bundletool with arguments: ${JSON.stringify(args)}`);
  let stdout;
  try {
    ({
      stdout
    } = await (0, _teen_process.exec)(await (0, _helpers.getJavaForOs)(), args, {
      env,
      timeout: BUNDLETOOL_TIMEOUT_MS
    }));
    _logger.default.debug(`Command stdout: ${_lodash.default.truncate(stdout, {
      length: 300
    })}`);
    return stdout;
  } catch (e) {
    if (e.stdout) {
      _logger.default.debug(`Command stdout: ${e.stdout}`);
    }
    if (e.stderr) {
      _logger.default.debug(`Command stderr: ${e.stderr}`);
    }
    throw new Error(`${errorMsg}. Original error: ${e.message}`);
  }
};
apksUtilsMethods.getDeviceSpec = async function getDeviceSpec(specLocation) {
  const args = ['get-device-spec', '--adb', this.executable.path, '--device-id', this.curDeviceId, '--output', specLocation];
  _logger.default.debug(`Getting the spec for the device '${this.curDeviceId}'`);
  await this.execBundletool(args, 'Cannot retrieve the device spec');
  return specLocation;
};
apksUtilsMethods.installMultipleApks = async function installMultipleApks(apkPathsToInstall, options = {}) {
  const installArgs = (0, _helpers.buildInstallArgs)(await this.getApiLevel(), options);
  return await this.adbExec(['install-multiple', ...installArgs, ...apkPathsToInstall], {
    timeout: options.timeout,
    timeoutCapName: options.timeoutCapName
  });
};
apksUtilsMethods.installApks = async function installApks(apks, options = {}) {
  const {
    grantPermissions,
    allowTestPackages,
    timeout
  } = options;
  const args = ['install-apks', '--adb', this.executable.path, '--apks', apks, '--timeout-millis', timeout || _helpers.APKS_INSTALL_TIMEOUT, '--device-id', this.curDeviceId];
  if (allowTestPackages) {
    args.push('--allow-test-only');
  }
  const tasks = [this.execBundletool(args, `Cannot install '${_path.default.basename(apks)}' to the device ${this.curDeviceId}`)];
  if (grantPermissions) {
    tasks.push(this.getApkInfo(apks));
  }
  const [, apkInfo] = await _bluebird.default.all(tasks);
  if (grantPermissions && apkInfo) {
    await this.grantAllPermissions(apkInfo.name);
  }
};
apksUtilsMethods.extractBaseApk = async function extractBaseApk(apks) {
  return await extractFromApks(apks, ['splits', BASE_APK]);
};
apksUtilsMethods.extractLanguageApk = async function extractLanguageApk(apks, language = null) {
  if (language) {
    try {
      return await extractFromApks(apks, ['splits', LANGUAGE_APK(language)]);
    } catch (e) {
      _logger.default.debug(e.message);
      _logger.default.info(`Assuming that splitting by language is not enabled for the '${apks}' bundle ` + `and returning the main apk instead`);
      return await this.extractBaseApk(apks);
    }
  }
  const defaultLanguages = ['en', 'en_us'];
  for (const lang of defaultLanguages) {
    try {
      return await extractFromApks(apks, ['splits', LANGUAGE_APK(lang)]);
    } catch (ign) {}
  }
  _logger.default.info(`Cannot find any split apk for the default languages ${JSON.stringify(defaultLanguages)}. ` + `Returning the main apk instead.`);
  return await this.extractBaseApk(apks);
};
apksUtilsMethods.isTestPackageOnlyError = function isTestPackageOnlyError(output) {
  return /\[INSTALL_FAILED_TEST_ONLY\]/.test(output);
};
var _default = apksUtilsMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJCQVNFX0FQSyIsIkxBTkdVQUdFX0FQSyIsImxhbmciLCJBUEtTX0NBQ0hFIiwiTFJVIiwibWF4IiwiZGlzcG9zZSIsImFwa3NIYXNoIiwiZXh0cmFjdGVkRmlsZXNSb290IiwiZnMiLCJyaW1yYWYiLCJBUEtTX0NBQ0hFX0dVQVJEIiwiQXN5bmNMb2NrIiwiQlVORExFVE9PTF9USU1FT1VUX01TIiwiYXBrc1V0aWxzTWV0aG9kcyIsInByb2Nlc3MiLCJvbiIsInNpemUiLCJwYXRocyIsInZhbHVlcyIsImxvZyIsImRlYnVnIiwibGVuZ3RoIiwidXRpbCIsInBsdXJhbGl6ZSIsImFwcFBhdGgiLCJyaW1yYWZTeW5jIiwiZSIsIndhcm4iLCJtZXNzYWdlIiwiZXh0cmFjdEZyb21BcGtzIiwiYXBrcyIsImRzdFBhdGgiLCJfIiwiaXNBcnJheSIsImFjcXVpcmUiLCJoYXNoIiwiaGFzIiwicmVzdWx0UGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0IiwiZXhpc3RzIiwiZGVsIiwidG1wUm9vdCIsInRlbXBEaXIiLCJvcGVuRGlyIiwidW56aXBGaWxlIiwiRXJyb3IiLCJqb2luIiwic2VwIiwic2V0IiwiZXhlY0J1bmRsZXRvb2wiLCJhcmdzIiwiZXJyb3JNc2ciLCJpbml0QnVuZGxldG9vbCIsImJpbmFyaWVzIiwiYnVuZGxldG9vbCIsImVudiIsImFkYlBvcnQiLCJBTkRST0lEX0FEQl9TRVJWRVJfUE9SVCIsImFkYkhvc3QiLCJBTkRST0lEX0FEQl9TRVJWRVJfSE9TVCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGRvdXQiLCJleGVjIiwiZ2V0SmF2YUZvck9zIiwidGltZW91dCIsInRydW5jYXRlIiwic3RkZXJyIiwiZ2V0RGV2aWNlU3BlYyIsInNwZWNMb2NhdGlvbiIsImV4ZWN1dGFibGUiLCJjdXJEZXZpY2VJZCIsImluc3RhbGxNdWx0aXBsZUFwa3MiLCJhcGtQYXRoc1RvSW5zdGFsbCIsIm9wdGlvbnMiLCJpbnN0YWxsQXJncyIsImJ1aWxkSW5zdGFsbEFyZ3MiLCJnZXRBcGlMZXZlbCIsImFkYkV4ZWMiLCJ0aW1lb3V0Q2FwTmFtZSIsImluc3RhbGxBcGtzIiwiZ3JhbnRQZXJtaXNzaW9ucyIsImFsbG93VGVzdFBhY2thZ2VzIiwiQVBLU19JTlNUQUxMX1RJTUVPVVQiLCJwdXNoIiwidGFza3MiLCJiYXNlbmFtZSIsImdldEFwa0luZm8iLCJhcGtJbmZvIiwiQiIsImFsbCIsImdyYW50QWxsUGVybWlzc2lvbnMiLCJuYW1lIiwiZXh0cmFjdEJhc2VBcGsiLCJleHRyYWN0TGFuZ3VhZ2VBcGsiLCJsYW5ndWFnZSIsImluZm8iLCJkZWZhdWx0TGFuZ3VhZ2VzIiwiaWduIiwiaXNUZXN0UGFja2FnZU9ubHlFcnJvciIsIm91dHB1dCIsInRlc3QiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvdG9vbHMvYXBrcy11dGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCB1dGlsIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJztcbmltcG9ydCB7XG4gIGdldEphdmFGb3JPcywgdW56aXBGaWxlLCBidWlsZEluc3RhbGxBcmdzLCBBUEtTX0lOU1RBTExfVElNRU9VVFxufSBmcm9tICcuLi9oZWxwZXJzLmpzJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbmNvbnN0IEJBU0VfQVBLID0gJ2Jhc2UtbWFzdGVyLmFwayc7XG5jb25zdCBMQU5HVUFHRV9BUEsgPSAobGFuZykgPT4gYGJhc2UtJHtsYW5nfS5hcGtgO1xuY29uc3QgQVBLU19DQUNIRSA9IG5ldyBMUlUoe1xuICBtYXg6IDEwLFxuICBkaXNwb3NlOiAoYXBrc0hhc2gsIGV4dHJhY3RlZEZpbGVzUm9vdCkgPT4gZnMucmltcmFmKGV4dHJhY3RlZEZpbGVzUm9vdCksXG59KTtcbmNvbnN0IEFQS1NfQ0FDSEVfR1VBUkQgPSBuZXcgQXN5bmNMb2NrKCk7XG5jb25zdCBCVU5ETEVUT09MX1RJTUVPVVRfTVMgPSA0ICogNjAgKiAxMDAwO1xuXG5jb25zdCBhcGtzVXRpbHNNZXRob2RzID0ge307XG5cbnByb2Nlc3Mub24oJ2V4aXQnLCAoKSA9PiB7XG4gIGlmICghQVBLU19DQUNIRS5zaXplKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcGF0aHMgPSBbLi4uQVBLU19DQUNIRS52YWx1ZXMoKV07XG4gIGxvZy5kZWJ1ZyhgUGVyZm9ybWluZyBjbGVhbnVwIG9mICR7cGF0aHMubGVuZ3RofSBjYWNoZWQgLmFwa3MgYCArXG4gICAgdXRpbC5wbHVyYWxpemUoJ3BhY2thZ2UnLCBwYXRocy5sZW5ndGgpKTtcbiAgZm9yIChjb25zdCBhcHBQYXRoIG9mIHBhdGhzKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEFzeW5jaHJvbm91cyBjYWxscyBhcmUgbm90IHN1cHBvcnRlZCBpbiBvbkV4aXQgaGFuZGxlclxuICAgICAgZnMucmltcmFmU3luYyhhcHBQYXRoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2cud2FybihlLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8qKlxuICogRXh0cmFjdHMgdGhlIHBhcnRpY3VsYXIgYXBrcyBwYWNrYWdlIGludG8gYSB0ZW1wb3JhcnkgZm9sZGVyLFxuICogZmluZHMgYW5kIHJldHVybnMgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZmlsZSBjb250YWluZWQgaW4gdGhpcyBhcGsuXG4gKiBUaGUgcmVzdWx0aW5nIHRlbXBvcmFyeSBwYXRoLCB3aGVyZSB0aGUgLmFwa3MgZmlsZSBoYXMgYmVlbiBleHRyYWN0ZWQsXG4gKiB3aWxsIGJlIHN0b3JlZCBpbnRvIHRoZSBpbnRlcm5hbCBMUlUgY2FjaGUgZm9yIGJldHRlciBwZXJmb3JtYW5jZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrcyAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIC5hcGtzIGZpbGVcbiAqIEBwYXJhbSB7c3RyaW5nfEFycmF5PFN0cmluZz59IGRzdFBhdGggLSBUaGUgcmVsYXRpdmUgcGF0aCB0byB0aGUgZGVzdGluYXRpb24gZmlsZSxcbiAqIHdoaWNoIGlzIGdvaW5nIHRvIGJlIGV4dHJhY3RlZCwgd2hlcmUgZWFjaCBwYXRoIGNvbXBvbmVudCBpcyBhbiBhcnJheSBpdGVtXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBGdWxsIHBhdGggdG8gdGhlIGV4dHJhY3RlZCBmaWxlXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHJlcXVlc3RlZCBpdGVtIGRvZXMgbm90IGV4aXN0IGluIHRoZSBleHRyYWN0ZWQgYXJjaGl2ZSBvciB0aGUgcHJvdmlkZXNcbiAqIGFwa3MgZmlsZSBpcyBub3QgYSB2YWxpZCBidW5kbGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXh0cmFjdEZyb21BcGtzIChhcGtzLCBkc3RQYXRoKSB7XG4gIGlmICghXy5pc0FycmF5KGRzdFBhdGgpKSB7XG4gICAgZHN0UGF0aCA9IFtkc3RQYXRoXTtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBBUEtTX0NBQ0hFX0dVQVJELmFjcXVpcmUoYXBrcywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEl0IG1pZ2h0IGJlIHRoYXQgdGhlIG9yaWdpbmFsIGZpbGUgaGFzIGJlZW4gcmVwbGFjZWQsXG4gICAgLy8gc28gd2UgbmVlZCB0byBrZWVwIHRoZSBoYXNoIHN1bXMgaW5zdGVhZCBvZiB0aGUgYWN0dWFsIGZpbGUgcGF0aHNcbiAgICAvLyBhcyBjYWNoaW5nIGtleXNcbiAgICBjb25zdCBhcGtzSGFzaCA9IGF3YWl0IGZzLmhhc2goYXBrcyk7XG4gICAgbG9nLmRlYnVnKGBDYWxjdWxhdGVkICcke2Fwa3N9JyBoYXNoOiAke2Fwa3NIYXNofWApO1xuXG4gICAgaWYgKEFQS1NfQ0FDSEUuaGFzKGFwa3NIYXNoKSkge1xuICAgICAgY29uc3QgcmVzdWx0UGF0aCA9IHBhdGgucmVzb2x2ZShBUEtTX0NBQ0hFLmdldChhcGtzSGFzaCksIC4uLmRzdFBhdGgpO1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhyZXN1bHRQYXRoKSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0UGF0aDtcbiAgICAgIH1cbiAgICAgIEFQS1NfQ0FDSEUuZGVsKGFwa3NIYXNoKTtcbiAgICB9XG5cbiAgICBjb25zdCB0bXBSb290ID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gICAgbG9nLmRlYnVnKGBVbnBhY2tpbmcgYXBwbGljYXRpb24gYnVuZGxlIGF0ICcke2Fwa3N9JyB0byAnJHt0bXBSb290fSdgKTtcbiAgICBhd2FpdCB1bnppcEZpbGUoYXBrcywgdG1wUm9vdCk7XG4gICAgY29uc3QgcmVzdWx0UGF0aCA9IHBhdGgucmVzb2x2ZSh0bXBSb290LCAuLi5kc3RQYXRoKTtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhyZXN1bHRQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2RzdFBhdGguam9pbihwYXRoLnNlcCl9IGNhbm5vdCBiZSBmb3VuZCBpbiAnJHthcGtzfScgYnVuZGxlLiBgICtcbiAgICAgICAgYERvZXMgdGhlIGFyY2hpdmUgY29udGFpbiBhIHZhbGlkIGFwcGxpY2F0aW9uIGJ1bmRsZT9gKTtcbiAgICB9XG4gICAgQVBLU19DQUNIRS5zZXQoYXBrc0hhc2gsIHRtcFJvb3QpO1xuICAgIHJldHVybiByZXN1bHRQYXRoO1xuICB9KTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyBidW5kbGV0b29sIHV0aWxpdHkgd2l0aCBnaXZlbiBhcmd1bWVudHMgYW5kIHJldHVybnMgdGhlIGFjdHVhbCBzdGRvdXRcbiAqXG4gKiBAcGFyYW0ge0FycmF5PFN0cmluZz59IGFyZ3MgLSB0aGUgbGlzdCBvZiBidW5kbGV0b29sIGFyZ3VtZW50c1xuICogQHBhcmFtIHtzdHJpbmd9IGVycm9yTXNnIC0gVGhlIGN1c3RvbWl6ZWQgZXJyb3IgbWVzc2FnZSBzdHJpbmdcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHRoZSBhY3R1YWwgY29tbWFuZCBzdGRvdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBidW5kbGV0b29sIGphciBkb2VzIG5vdCBleGlzdCBpbiBQQVRIIG9yIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZVxuICogZXhlY3V0aW5nIGl0XG4gKi9cbmFwa3NVdGlsc01ldGhvZHMuZXhlY0J1bmRsZXRvb2wgPSBhc3luYyBmdW5jdGlvbiBleGVjQnVuZGxldG9vbCAoYXJncywgZXJyb3JNc2cpIHtcbiAgYXdhaXQgdGhpcy5pbml0QnVuZGxldG9vbCgpO1xuICBhcmdzID0gW1xuICAgICctamFyJywgdGhpcy5iaW5hcmllcy5idW5kbGV0b29sLFxuICAgIC4uLmFyZ3NcbiAgXTtcbiAgY29uc3QgZW52ID0gcHJvY2Vzcy5lbnY7XG4gIGlmICh0aGlzLmFkYlBvcnQpIHtcbiAgICBlbnYuQU5EUk9JRF9BREJfU0VSVkVSX1BPUlQgPSBgJHt0aGlzLmFkYlBvcnR9YDtcbiAgfVxuICBpZiAodGhpcy5hZGJIb3N0KSB7XG4gICAgZW52LkFORFJPSURfQURCX1NFUlZFUl9IT1NUID0gdGhpcy5hZGJIb3N0O1xuICB9XG4gIGxvZy5kZWJ1ZyhgRXhlY3V0aW5nIGJ1bmRsZXRvb2wgd2l0aCBhcmd1bWVudHM6ICR7SlNPTi5zdHJpbmdpZnkoYXJncyl9YCk7XG4gIGxldCBzdGRvdXQ7XG4gIHRyeSB7XG4gICAgKHtzdGRvdXR9ID0gYXdhaXQgZXhlYyhhd2FpdCBnZXRKYXZhRm9yT3MoKSwgYXJncywge1xuICAgICAgZW52LFxuICAgICAgdGltZW91dDogQlVORExFVE9PTF9USU1FT1VUX01TLFxuICAgIH0pKTtcbiAgICBsb2cuZGVidWcoYENvbW1hbmQgc3Rkb3V0OiAke18udHJ1bmNhdGUoc3Rkb3V0LCB7bGVuZ3RoOiAzMDB9KX1gKTtcbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKGUuc3Rkb3V0KSB7XG4gICAgICBsb2cuZGVidWcoYENvbW1hbmQgc3Rkb3V0OiAke2Uuc3Rkb3V0fWApO1xuICAgIH1cbiAgICBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ29tbWFuZCBzdGRlcnI6ICR7ZS5zdGRlcnJ9YCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgJHtlcnJvck1zZ30uIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiBAcGFyYW0ge3N0cmluZ30gc3BlY0xvY2F0aW9uIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgZ2VuZXJhdGVkIGRldmljZSBzcGVjIGxvY2F0aW9uXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc2FtZSBgc3BlY0xvY2F0aW9uYCB2YWx1ZVxuICogQHRocm93cyB7RXJyb3J9IElmIGl0IGlzIG5vdCBwb3NzaWJsZSB0byByZXRyaWV2ZSB0aGUgc3BlYyBmb3IgdGhlIGN1cnJlbnQgZGV2aWNlXG4gKi9cbmFwa3NVdGlsc01ldGhvZHMuZ2V0RGV2aWNlU3BlYyA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZVNwZWMgKHNwZWNMb2NhdGlvbikge1xuICBjb25zdCBhcmdzID0gW1xuICAgICdnZXQtZGV2aWNlLXNwZWMnLFxuICAgICctLWFkYicsIHRoaXMuZXhlY3V0YWJsZS5wYXRoLFxuICAgICctLWRldmljZS1pZCcsIHRoaXMuY3VyRGV2aWNlSWQsXG4gICAgJy0tb3V0cHV0Jywgc3BlY0xvY2F0aW9uLFxuICBdO1xuICBsb2cuZGVidWcoYEdldHRpbmcgdGhlIHNwZWMgZm9yIHRoZSBkZXZpY2UgJyR7dGhpcy5jdXJEZXZpY2VJZH0nYCk7XG4gIGF3YWl0IHRoaXMuZXhlY0J1bmRsZXRvb2woYXJncywgJ0Nhbm5vdCByZXRyaWV2ZSB0aGUgZGV2aWNlIHNwZWMnKTtcbiAgcmV0dXJuIHNwZWNMb2NhdGlvbjtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbE11bHRpcGxlQXBrc09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IHRpbWVvdXQgWzIwMDAwXSAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWxcbiAqIHRoZSBpbnN0YWxsYXRpb24gaXMgY29tcGxldGVkXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdGltZW91dENhcE5hbWUgW2FuZHJvaWRJbnN0YWxsVGltZW91dF0gLSBUaGUgdGltZW91dCBvcHRpb24gbmFtZVxuICogdXNlcnMgY2FuIGluY3JlYXNlIHRoZSB0aW1lb3V0LlxuICogQHByb3BlcnR5IHtib29sZWFufSBhbGxvd1Rlc3RQYWNrYWdlcyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gYWxsb3cgdGVzdFxuICogcGFja2FnZXMgaW5zdGFsbGF0aW9uLlxuICogQHByb3BlcnR5IHtib29sZWFufSB1c2VTZGNhcmQgW2ZhbHNlXSAtIFNldCB0byB0cnVlIHRvIGluc3RhbGwgdGhlIGFwcCBvbiBzZGNhcmRcbiAqIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqIHBlcm1pc3Npb25zIHJlcXVlc3RlZCBpbiB0aGUgYXBwbGljYXRpb24ncyBtYW5pZmVzdCBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBpbnN0YWxsYXRpb25cbiAqIGlzIGNvbXBsZXRlZCB1bmRlciBBbmRyb2lkIDYrLlxuICogQHByb3BlcnR5IHtib29sZWFufSBwYXJ0aWFsSW5zdGFsbCBbZmFsc2VdIC0gSW5zdGFsbCBhcGtzIHBhcnRpYWxseS4gSXQgaXMgdXNlZCBmb3IgJ2luc3RhbGwtbXVsdGlwbGUnLlxuICogaHR0cHM6Ly9hbmRyb2lkLnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8xMTEwNjQvd2hhdC1pcy1hLXBhcnRpYWwtYXBwbGljYXRpb24taW5zdGFsbC12aWEtYWRiXG4gKi9cblxuLyoqXG4gKiBJbnN0YWxscyB0aGUgZ2l2ZW4gYXBrcyBpbnRvIHRoZSBkZXZpY2UgdW5kZXIgdGVzdFxuICpcbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gYXBrUGF0aHNUb0luc3RhbGwgLSBUaGUgZnVsbCBwYXRocyB0byBpbnN0YWxsIGFwa3NcbiAqIEBwYXJhbSB7P2luc3RhbGxNdWx0aXBsZUFwa3NPcHRpb25zfSBvcHRpb25zIC0gSW5zdGFsbGF0aW9uIG9wdGlvbnNcbiAqL1xuYXBrc1V0aWxzTWV0aG9kcy5pbnN0YWxsTXVsdGlwbGVBcGtzID0gYXN5bmMgZnVuY3Rpb24gaW5zdGFsbE11bHRpcGxlQXBrcyAoYXBrUGF0aHNUb0luc3RhbGwsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBpbnN0YWxsQXJncyA9IGJ1aWxkSW5zdGFsbEFyZ3MoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpLCBvcHRpb25zKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMuYWRiRXhlYyhbJ2luc3RhbGwtbXVsdGlwbGUnLCAuLi5pbnN0YWxsQXJncywgLi4uYXBrUGF0aHNUb0luc3RhbGxdLCB7XG4gICAgdGltZW91dDogb3B0aW9ucy50aW1lb3V0LFxuICAgIHRpbWVvdXRDYXBOYW1lOiBvcHRpb25zLnRpbWVvdXRDYXBOYW1lLFxuICB9KTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gSW5zdGFsbEFwa3NPcHRpb25zXG4gKiBAcHJvcGVydHkgez9udW1iZXJ8c3RyaW5nfSB0aW1lb3V0IFsxMjAwMDBdIC0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbFxuICogdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0aW1lb3V0Q2FwTmFtZSBbYW5kcm9pZEluc3RhbGxUaW1lb3V0XSAtIFRoZSB0aW1lb3V0IG9wdGlvbiBuYW1lXG4gKiB1c2VycyBjYW4gaW5jcmVhc2UgdGhlIHRpbWVvdXQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqIHBlcm1pc3Npb25zIHJlcXVlc3RlZCBpbiB0aGUgYXBwbGljYXRpb24ncyBtYW5pZmVzdCBhdXRvbWF0aWNhbGx5IGFmdGVyIHRoZSBpbnN0YWxsYXRpb25cbiAqIGlzIGNvbXBsZXRlZCB1bmRlciBBbmRyb2lkIDYrLlxuICovXG5cbi8qKlxuICogSW5zdGFsbHMgdGhlIGdpdmVuIC5hcGtzIHBhY2thZ2UgaW50byB0aGUgZGV2aWNlIHVuZGVyIHRlc3RcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrcyAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIC5hcGtzIGZpbGVcbiAqIEBwYXJhbSB7P0luc3RhbGxBcGtzT3B0aW9uc30gb3B0aW9ucyAtIEluc3RhbGxhdGlvbiBvcHRpb25zXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIC5hcGtzIGJ1bmRsZSBjYW5ub3QgYmUgaW5zdGFsbGVkXG4gKi9cbmFwa3NVdGlsc01ldGhvZHMuaW5zdGFsbEFwa3MgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsQXBrcyAoYXBrcywgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBncmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICAgIHRpbWVvdXQsXG4gIH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IGFyZ3MgPSBbXG4gICAgJ2luc3RhbGwtYXBrcycsXG4gICAgJy0tYWRiJywgdGhpcy5leGVjdXRhYmxlLnBhdGgsXG4gICAgJy0tYXBrcycsIGFwa3MsXG4gICAgJy0tdGltZW91dC1taWxsaXMnLCB0aW1lb3V0IHx8IEFQS1NfSU5TVEFMTF9USU1FT1VULFxuICAgICctLWRldmljZS1pZCcsIHRoaXMuY3VyRGV2aWNlSWQsXG4gIF07XG4gIGlmIChhbGxvd1Rlc3RQYWNrYWdlcykge1xuICAgIGFyZ3MucHVzaCgnLS1hbGxvdy10ZXN0LW9ubHknKTtcbiAgfVxuICBjb25zdCB0YXNrcyA9IFtcbiAgICB0aGlzLmV4ZWNCdW5kbGV0b29sKGFyZ3MsIGBDYW5ub3QgaW5zdGFsbCAnJHtwYXRoLmJhc2VuYW1lKGFwa3MpfScgdG8gdGhlIGRldmljZSAke3RoaXMuY3VyRGV2aWNlSWR9YClcbiAgXTtcbiAgaWYgKGdyYW50UGVybWlzc2lvbnMpIHtcbiAgICB0YXNrcy5wdXNoKHRoaXMuZ2V0QXBrSW5mbyhhcGtzKSk7XG4gIH1cbiAgY29uc3QgWywgYXBrSW5mb10gPSBhd2FpdCBCLmFsbCh0YXNrcyk7XG4gIGlmIChncmFudFBlcm1pc3Npb25zICYmIGFwa0luZm8pIHtcbiAgICAvLyBUT0RPOiBTaW1wbGlmeSBpdCBhZnRlciBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2J1bmRsZXRvb2wvaXNzdWVzLzI0NiBpcyBpbXBsZW1lbnRlZFxuICAgIGF3YWl0IHRoaXMuZ3JhbnRBbGxQZXJtaXNzaW9ucyhhcGtJbmZvLm5hbWUpO1xuICB9XG59O1xuXG4vKipcbiAqIEV4dHJhY3RzIGFuZCByZXR1cm5zIHRoZSBmdWxsIHBhdGggdG8gdGhlIG1hc3RlciAuYXBrIGZpbGUgaW5zaWRlIHRoZSBidW5kbGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwa3MgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSAuYXBrcyBmaWxlXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBtYXN0ZXIgYnVuZGxlIC5hcGtcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZXh0cmFjdGluZy9maW5kaW5nIHRoZSBmaWxlXG4gKi9cbmFwa3NVdGlsc01ldGhvZHMuZXh0cmFjdEJhc2VBcGsgPSBhc3luYyBmdW5jdGlvbiBleHRyYWN0QmFzZUFwayAoYXBrcykge1xuICByZXR1cm4gYXdhaXQgZXh0cmFjdEZyb21BcGtzKGFwa3MsIFsnc3BsaXRzJywgQkFTRV9BUEtdKTtcbn07XG5cbi8qKlxuICogRXh0cmFjdHMgYW5kIHJldHVybnMgdGhlIGZ1bGwgcGF0aCB0byB0aGUgLmFwaywgd2hpY2ggY29udGFpbnMgdGhlIGNvcnJlc3BvbmRpbmdcbiAqIHJlc291cmNlcyBmb3IgdGhlIGdpdmVuIGxhbmd1YWdlIGluIHRoZSAuYXBrcyBidW5kbGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwa3MgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSAuYXBrcyBmaWxlXG4gKiBAcGFyYW0gez9zdHJpbmd9IGxhbmd1YWdlIC0gVGhlIGxhbmd1YWdlIGFiYnJldmlhdGlvbi4gVGhlIGRlZmF1bHQgbGFuZ3VhZ2UgaXNcbiAqIGdvaW5nIHRvIGJlIHNlbGVjdGVkIGlmIGl0IGlzIG5vdCBzZXQuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBjb3JyZXNwb25kaW5nIGxhbmd1YWdlIC5hcGsgb3IgdGhlIG1hc3RlciAuYXBrXG4gKiBpZiBsYW5ndWFnZSBzcGxpdCBpcyBub3QgZW5hYmxlZCBmb3IgdGhlIGJ1bmRsZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZXh0cmFjdGluZy9maW5kaW5nIHRoZSBmaWxlXG4gKi9cbmFwa3NVdGlsc01ldGhvZHMuZXh0cmFjdExhbmd1YWdlQXBrID0gYXN5bmMgZnVuY3Rpb24gZXh0cmFjdExhbmd1YWdlQXBrIChhcGtzLCBsYW5ndWFnZSA9IG51bGwpIHtcbiAgaWYgKGxhbmd1YWdlKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBleHRyYWN0RnJvbUFwa3MoYXBrcywgWydzcGxpdHMnLCBMQU5HVUFHRV9BUEsobGFuZ3VhZ2UpXSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmRlYnVnKGUubWVzc2FnZSk7XG4gICAgICBsb2cuaW5mbyhgQXNzdW1pbmcgdGhhdCBzcGxpdHRpbmcgYnkgbGFuZ3VhZ2UgaXMgbm90IGVuYWJsZWQgZm9yIHRoZSAnJHthcGtzfScgYnVuZGxlIGAgK1xuICAgICAgICBgYW5kIHJldHVybmluZyB0aGUgbWFpbiBhcGsgaW5zdGVhZGApO1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBrcyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgZGVmYXVsdExhbmd1YWdlcyA9IFsnZW4nLCAnZW5fdXMnXTtcbiAgZm9yIChjb25zdCBsYW5nIG9mIGRlZmF1bHRMYW5ndWFnZXMpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGV4dHJhY3RGcm9tQXBrcyhhcGtzLCBbJ3NwbGl0cycsIExBTkdVQUdFX0FQSyhsYW5nKV0pO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuXG4gIGxvZy5pbmZvKGBDYW5ub3QgZmluZCBhbnkgc3BsaXQgYXBrIGZvciB0aGUgZGVmYXVsdCBsYW5ndWFnZXMgJHtKU09OLnN0cmluZ2lmeShkZWZhdWx0TGFuZ3VhZ2VzKX0uIGAgK1xuICAgIGBSZXR1cm5pbmcgdGhlIG1haW4gYXBrIGluc3RlYWQuYCk7XG4gIHJldHVybiBhd2FpdCB0aGlzLmV4dHJhY3RCYXNlQXBrKGFwa3MpO1xufTtcblxuYXBrc1V0aWxzTWV0aG9kcy5pc1Rlc3RQYWNrYWdlT25seUVycm9yID0gZnVuY3Rpb24gaXNUZXN0UGFja2FnZU9ubHlFcnJvciAob3V0cHV0KSB7XG4gIHJldHVybiAvXFxbSU5TVEFMTF9GQUlMRURfVEVTVF9PTkxZXFxdLy50ZXN0KG91dHB1dCk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhcGtzVXRpbHNNZXRob2RzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtB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