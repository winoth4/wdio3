{"version":3,"file":"adb.js","names":["DEFAULT_ADB_PORT","DEFAULT_OPTS","sdkRoot","getSdkRootFromEnv","udid","appDeviceReadyTimeout","useKeystore","keystorePath","keystorePassword","keyAlias","keyPassword","executable","path","defaultArgs","tmpDir","os","tmpdir","curDeviceId","emulatorPort","logcat","binaries","instrumentProc","suppressKillServer","jars","adbPort","adbHost","adbExecTimeout","DEFAULT_ADB_EXEC_TIMEOUT","remoteAppsCacheLimit","buildToolsVersion","allowOfflineDevices","allowDelayAdb","ADB","constructor","opts","Object","assign","_","defaultsDeep","cloneDeep","remoteAdbHost","push","remoteAdbPort","clone","originalOptions","pick","keys","cloneOptions","includes","splice","indexOf","createADB","adb","requireSdkRoot","getAdbWithCorrectAdbPath","adbExec","e","log","warn","stderr","message","fnName","fn","toPairs","methods","prototype"],"sources":["../../lib/adb.js"],"sourcesContent":["import _ from 'lodash';\nimport os from 'os';\nimport methods, { getAndroidBinaryPath } from './tools/index.js';\nimport {\n  DEFAULT_ADB_EXEC_TIMEOUT, requireSdkRoot, getSdkRootFromEnv\n} from './helpers';\nimport log from './logger.js';\n\nconst DEFAULT_ADB_PORT = 5037;\nconst DEFAULT_OPTS = {\n  sdkRoot: getSdkRootFromEnv() || null,\n  udid: null,\n  appDeviceReadyTimeout: null,\n  useKeystore: null,\n  keystorePath: null,\n  keystorePassword: null,\n  keyAlias: null,\n  keyPassword: null,\n  executable: {path: 'adb', defaultArgs: []},\n  tmpDir: os.tmpdir(),\n  curDeviceId: null,\n  emulatorPort: null,\n  logcat: null,\n  binaries: {},\n  instrumentProc: null,\n  suppressKillServer: null,\n  jars: {},\n  adbPort: DEFAULT_ADB_PORT,\n  adbHost: null,\n  adbExecTimeout: DEFAULT_ADB_EXEC_TIMEOUT,\n  remoteAppsCacheLimit: 10,\n  buildToolsVersion: null,\n  allowOfflineDevices: false,\n  allowDelayAdb: true,\n};\n\nclass ADB {\n  constructor (opts = {}) {\n    Object.assign(this, opts);\n    _.defaultsDeep(this, _.cloneDeep(DEFAULT_OPTS));\n\n    if (opts.remoteAdbHost) {\n      this.executable.defaultArgs.push('-H', opts.remoteAdbHost);\n      this.adbHost = opts.remoteAdbHost;\n    }\n    // TODO figure out why we have this option as it does not appear to be\n    // used anywhere. Probably deprecate in favor of simple opts.adbPort\n    if (opts.remoteAdbPort) {\n      this.adbPort = opts.remoteAdbPort;\n    }\n    this.executable.defaultArgs.push('-P', this.adbPort);\n  }\n\n  /**\n   * Create a new instance of `ADB` that inherits configuration from this `ADB` instance.\n   * This avoids the need to call `ADB.createADB()` multiple times.\n   * @param {object} opts - Additional options mapping to pass to the `ADB` constructor.\n   * @returns {ADB} The resulting class instance.\n   */\n  clone (opts = {}) {\n    const originalOptions = _.cloneDeep(_.pick(this, Object.keys(DEFAULT_OPTS)));\n    const cloneOptions = _.defaultsDeep(opts, originalOptions);\n\n    // Reset default arguments created in the constructor.\n    // Without this code, -H and -P can be injected into defaultArgs multiple times.\n    const defaultArgs = cloneOptions.executable.defaultArgs;\n    if (cloneOptions.remoteAdbHost && defaultArgs.includes('-H')) {\n      defaultArgs.splice(defaultArgs.indexOf('-H'), 2);\n    }\n    if (defaultArgs.includes('-P')) {\n      defaultArgs.splice(defaultArgs.indexOf('-P'), 2);\n    }\n\n    return new ADB(cloneOptions);\n  }\n}\n\nADB.createADB = async function createADB (opts) {\n  const adb = new ADB(opts);\n  adb.sdkRoot = await requireSdkRoot(adb.sdkRoot);\n  await adb.getAdbWithCorrectAdbPath();\n  try {\n    await adb.adbExec(['start-server']);\n  } catch (e) {\n    log.warn(e.stderr || e.message);\n  }\n  return adb;\n};\n\n// add all the methods to the ADB prototype\nfor (const [fnName, fn] of _.toPairs(methods)) {\n  ADB.prototype[fnName] = fn;\n}\n\nexport default ADB;\nexport { ADB, DEFAULT_ADB_PORT, getAndroidBinaryPath, getSdkRootFromEnv };\n"],"mappings":"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"}