{"version":3,"file":"network.js","names":["commands","helpers","extensions","AIRPLANE_MODE_MASK","WIFI_MASK","DATA_MASK","GEO_EPSILON","Number","MIN_VALUE","getNetworkConnection","log","info","airplaneModeOn","adb","isAirplaneModeOn","connection","wifiOn","isWifiOn","dataOn","isDataOn","setNetworkConnection","type","shouldEnableAirplaneMode","shouldEnableWifi","shouldEnableDataConnection","currentState","isAirplaneModeEnabled","isWiFiEnabled","isDataEnabled","wrapBootstrapDisconnect","setAirplaneMode","broadcastAirplaneMode","setWifiState","setDataState","isEmulator","wifi","toggleData","data","setWifiAndData","toggleWiFi","toggleFlightMode","flightMode","setGeoLocation","location","getGeoLocation","e","warn","message","latitude","longitude","altitude","mobileRefreshGpsCache","opts","timeoutMs","refreshGeoLocationCache","parseFloat","KeyCode","UP","DOWN","RIGHT","CENTER","toggleLocationServices","api","getApiLevel","providers","getLocationProviders","isGpsEnabled","indexOf","toggleGPSLocationProvider","seq","push","keyevent","toggleSetting","errors","NotYetImplementedError","setting","preKeySeq","_","isNull","openSettingsActivity","key","doKey","appPackage","appActivity","getFocusedPackageAndActivity","waitForNotActivity","ign","back","B","delay","wrapped","bootstrap","ignoreUnexpectedShutdown","restart","start","disableAndroidWatchers","acceptSslCerts","Object","assign"],"sources":["../../../lib/commands/network.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\nimport B from 'bluebird';\n\nlet commands = {}, helpers = {}, extensions = {};\n\nconst AIRPLANE_MODE_MASK = 0b001;\nconst WIFI_MASK = 0b010;\nconst DATA_MASK = 0b100;\n// The value close to zero, but not zero, is needed\n// to trick JSON generation and send a float value instead of an integer,\n// This allows strictly-typed clients, like Java, to properly\n// parse it. Otherwise float 0.0 is always represented as integer 0 in JS.\n// The value must not be greater than DBL_EPSILON (https://opensource.apple.com/source/Libc/Libc-498/include/float.h)\nconst GEO_EPSILON = Number.MIN_VALUE;\n\ncommands.getNetworkConnection = async function getNetworkConnection () {\n  this.log.info('Getting network connection');\n  let airplaneModeOn = await this.adb.isAirplaneModeOn();\n  let connection = airplaneModeOn ? AIRPLANE_MODE_MASK : 0;\n\n  // no need to check anything else if we are in airplane mode\n  if (!airplaneModeOn) {\n    let wifiOn = await this.isWifiOn();\n    connection |= (wifiOn ? WIFI_MASK : 0);\n    let dataOn = await this.adb.isDataOn();\n    connection |= (dataOn ? DATA_MASK : 0);\n  }\n\n  return connection;\n};\n\n/**\n * decoupling to override the behaviour in other drivers like UiAutomator2.\n */\ncommands.isWifiOn = async function isWifiOn () {\n  return await this.adb.isWifiOn();\n};\n\ncommands.setNetworkConnection = async function setNetworkConnection (type) {\n  this.log.info('Setting network connection');\n  // decode the input\n  const shouldEnableAirplaneMode = (type & AIRPLANE_MODE_MASK) !== 0;\n  const shouldEnableWifi = (type & WIFI_MASK) !== 0;\n  const shouldEnableDataConnection = (type & DATA_MASK) !== 0;\n\n  const currentState = await this.getNetworkConnection();\n  const isAirplaneModeEnabled = (currentState & AIRPLANE_MODE_MASK) !== 0;\n  const isWiFiEnabled = (currentState & WIFI_MASK) !== 0;\n  const isDataEnabled = (currentState & DATA_MASK) !== 0;\n\n  if (shouldEnableAirplaneMode !== isAirplaneModeEnabled) {\n    await this.wrapBootstrapDisconnect(async () => {\n      await this.adb.setAirplaneMode(shouldEnableAirplaneMode);\n    });\n    await this.wrapBootstrapDisconnect(async () => {\n      await this.adb.broadcastAirplaneMode(shouldEnableAirplaneMode);\n    });\n  } else {\n    this.log.info(`Not changing airplane mode, since it is already ` +\n             `${shouldEnableAirplaneMode ? 'enabled' : 'disabled'}`);\n  }\n\n  if (shouldEnableWifi === isWiFiEnabled && shouldEnableDataConnection === isDataEnabled) {\n    this.log.info('Not changing data connection/Wi-Fi states, since they are already set to expected values');\n    if (await this.adb.isAirplaneModeOn()) {\n      return AIRPLANE_MODE_MASK | currentState;\n    }\n    return ~AIRPLANE_MODE_MASK & currentState;\n  }\n\n  await this.wrapBootstrapDisconnect(async () => {\n    if (shouldEnableWifi !== isWiFiEnabled) {\n      await this.setWifiState(shouldEnableWifi);\n    } else {\n      this.log.info(`Not changing Wi-Fi state, since it is already ` +\n        `${shouldEnableWifi ? 'enabled' : 'disabled'}`);\n    }\n\n    if (shouldEnableAirplaneMode) {\n      this.log.info('Not changing data connection state, because airplane mode is enabled');\n    } else if (shouldEnableDataConnection === isDataEnabled) {\n      this.log.info(`Not changing data connection state, since it is already ` +\n        `${shouldEnableDataConnection ? 'enabled' : 'disabled'}`);\n    } else {\n      await this.adb.setDataState(shouldEnableDataConnection, this.isEmulator());\n    }\n  });\n\n  return await this.getNetworkConnection();\n};\n\n/**\n * decoupling to override behaviour in other drivers like UiAutomator2.\n */\ncommands.setWifiState = async function setWifiState (wifi) {\n  await this.adb.setWifiState(wifi, this.isEmulator());\n};\n\ncommands.toggleData = async function toggleData () {\n  let data = !(await this.adb.isDataOn());\n  this.log.info(`Turning network data ${data ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({data}, this.isEmulator());\n  });\n};\n\ncommands.toggleWiFi = async function toggleWiFi () {\n  let wifi = !(await this.adb.isWifiOn());\n  this.log.info(`Turning WiFi ${wifi ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({wifi}, this.isEmulator());\n  });\n};\n\ncommands.toggleFlightMode = async function toggleFlightMode () {\n  /*\n   * TODO: Implement isRealDevice(). This method fails on\n   * real devices, it should throw a NotYetImplementedError\n   */\n  let flightMode = !(await this.adb.isAirplaneModeOn());\n  this.log.info(`Turning flight mode ${flightMode ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setAirplaneMode(flightMode);\n  });\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.broadcastAirplaneMode(flightMode);\n  });\n};\n\ncommands.setGeoLocation = async function setGeoLocation (location) {\n  await this.adb.setGeoLocation(location, this.isEmulator());\n  try {\n    return await this.getGeoLocation();\n  } catch (e) {\n    this.log.warn(`Could not get the current geolocation info: ${e.message}`);\n    this.log.warn(`Returning the default zero'ed values`);\n    return {\n      latitude: GEO_EPSILON,\n      longitude: GEO_EPSILON,\n      altitude: GEO_EPSILON,\n    };\n  }\n};\n\n/**\n * @typedef {Object} GpsCacheRefreshOptions\n * @property {number} timeoutMs [20000] The maximum number of milliseconds\n * to block until GPS cache is refreshed. Providing zero or a negative\n * value to it skips waiting completely.\n */\n\n/**\n * Sends an async request to refresh the GPS cache.\n * This feature only works if the device under test has\n * Google Play Services installed. In case the vanilla\n * LocationManager is used the device API level must be at\n * version 30 (Android R) or higher.\n *\n * @param {GpsCacheRefreshOptions} opts\n */\ncommands.mobileRefreshGpsCache = async function mobileRefreshGpsCache (opts = {}) {\n  const { timeoutMs } = opts;\n  await this.adb.refreshGeoLocationCache(timeoutMs);\n};\n\ncommands.getGeoLocation = async function getGeoLocation () {\n  const {latitude, longitude, altitude} = await this.adb.getGeoLocation();\n  return {\n    latitude: parseFloat(latitude) || GEO_EPSILON,\n    longitude: parseFloat(longitude) || GEO_EPSILON,\n    altitude: parseFloat(altitude) || GEO_EPSILON,\n  };\n};\n// https://developer.android.com/reference/android/view/KeyEvent.html#KEYCODE_DPAD_CENTER\n// in the android docs, this is how the keycodes are defined\nconst KeyCode = {\n  UP: 19,\n  DOWN: 20,\n  RIGHT: 22,\n  CENTER: 23\n};\ncommands.toggleLocationServices = async function toggleLocationServices () {\n  this.log.info('Toggling location services');\n  let api = await this.adb.getApiLevel();\n  if (this.isEmulator()) {\n    let providers = await this.adb.getLocationProviders();\n    let isGpsEnabled = providers.indexOf('gps') !== -1;\n    await this.adb.toggleGPSLocationProvider(!isGpsEnabled);\n    return;\n  }\n\n  if (api > 15) {\n    let seq = [KeyCode.UP, KeyCode.UP];\n    if (api === 16) {\n      // This version of Android has a \"parent\" button in its action bar\n      seq.push(KeyCode.DOWN);\n    } else if (api < 28) {\n      // Newer versions of Android have the toggle in the Action bar\n      seq = [KeyCode.RIGHT, KeyCode.RIGHT, KeyCode.UP];\n      /*\n       * Once the Location services switch is OFF, it won't receive focus\n       * when going back to the Location Services settings screen unless we\n       * send a dummy keyevent (UP) *before* opening the settings screen\n       */\n      await this.adb.keyevent(KeyCode.UP);\n    } else if (api >= 28) {\n      // Even newer versions of android have the toggle in a bar below the action bar\n      // this means a single right click will cause it to be selected.\n      seq = [KeyCode.RIGHT];\n      await this.adb.keyevent(KeyCode.UP);\n    }\n    await this.toggleSetting('LOCATION_SOURCE_SETTINGS', seq);\n  } else {\n    // There's no global location services toggle on older Android versions\n    throw new errors.NotYetImplementedError();\n  }\n};\n\nhelpers.toggleSetting = async function toggleSetting (setting, preKeySeq) {\n  /*\n   * preKeySeq is the keyevent sequence to send over ADB in order\n   * to position the cursor on the right option.\n   * By default it's [up, up, down] because we usually target the 1st item in\n   * the screen, and sometimes when opening settings activities the cursor is\n   * already positionned on the 1st item, but we can't know for sure\n   */\n  if (_.isNull(preKeySeq)) {\n    preKeySeq = [KeyCode.UP, KeyCode.UP, KeyCode.DOWN];\n  }\n\n  await this.openSettingsActivity(setting);\n\n  for (let key of preKeySeq) {\n    await this.doKey(key);\n  }\n\n  let {appPackage, appActivity} = await this.adb.getFocusedPackageAndActivity();\n\n  /*\n   * Click and handle potential ADB disconnect that occurs on official\n   * emulator when the network connection is disabled\n   */\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.doKey(KeyCode.CENTER);\n  });\n\n  /*\n   * In one particular case (enable Location Services), a pop-up is\n   * displayed on some platforms so the user accepts or refuses that Google\n   * collects location data. So we wait for that pop-up to open, if it\n   * doesn't then proceed\n   */\n  try {\n    await this.adb.waitForNotActivity(appPackage, appActivity, 5000);\n    await this.doKey(KeyCode.RIGHT);\n    await this.doKey(KeyCode.CENTER);\n    await this.adb.waitForNotActivity(appPackage, appActivity, 5000);\n  } catch (ign) {}\n\n  await this.adb.back();\n};\n\nhelpers.doKey = async function doKey (key) {\n  // TODO: Confirm we need this delay. Seems to work without it.\n  await B.delay(2000);\n  await this.adb.keyevent(key);\n};\n\nhelpers.wrapBootstrapDisconnect = async function wrapBootstrapDisconnect (wrapped) {\n  if (!this.bootstrap) {\n    return await wrapped();\n  }\n\n  this.bootstrap.ignoreUnexpectedShutdown = true;\n  try {\n    await wrapped();\n    await this.adb.restart();\n    await this.bootstrap.start(this.opts.appPackage, this.opts.disableAndroidWatchers, this.opts.acceptSslCerts);\n  } finally {\n    this.bootstrap.ignoreUnexpectedShutdown = false;\n  }\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}