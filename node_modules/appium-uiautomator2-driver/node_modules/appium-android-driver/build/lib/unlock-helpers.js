"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.helpers = exports.default = exports.PIN_UNLOCK_KEY_EVENT = exports.PIN_UNLOCK = exports.PATTERN_UNLOCK = exports.PASSWORD_UNLOCK = exports.FINGERPRINT_UNLOCK = void 0;
require("source-map-support/register");
var _logger = _interopRequireDefault(require("./logger"));
var _asyncbox = require("asyncbox");
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
const PIN_UNLOCK = 'pin';
exports.PIN_UNLOCK = PIN_UNLOCK;
const PIN_UNLOCK_KEY_EVENT = 'pinWithKeyEvent';
exports.PIN_UNLOCK_KEY_EVENT = PIN_UNLOCK_KEY_EVENT;
const PASSWORD_UNLOCK = 'password';
exports.PASSWORD_UNLOCK = PASSWORD_UNLOCK;
const PATTERN_UNLOCK = 'pattern';
exports.PATTERN_UNLOCK = PATTERN_UNLOCK;
const FINGERPRINT_UNLOCK = 'fingerprint';
exports.FINGERPRINT_UNLOCK = FINGERPRINT_UNLOCK;
const UNLOCK_TYPES = [PIN_UNLOCK, PIN_UNLOCK_KEY_EVENT, PASSWORD_UNLOCK, PATTERN_UNLOCK, FINGERPRINT_UNLOCK];
const KEYCODE_NUMPAD_ENTER = 66;
const UNLOCK_WAIT_TIME = 100;
const INPUT_KEYS_WAIT_TIME = 100;
const NUMBER_ZERO_KEYCODE = 7;
const helpers = {};
exports.helpers = helpers;
helpers.validateUnlockCapabilities = function validateUnlockCapabilities(caps = {}) {
  const {
    unlockKey,
    unlockType
  } = caps;
  if (_lodash.default.isNil(unlockKey) || unlockKey === '') {
    throw new Error('A non-empty unlock key value must be provided');
  }
  if ([PIN_UNLOCK, PIN_UNLOCK_KEY_EVENT, FINGERPRINT_UNLOCK].includes(unlockType)) {
    if (!/^[0-9]+$/.test(_lodash.default.trim(unlockKey))) {
      throw new Error(`Unlock key value '${unlockKey}' must only consist of digits`);
    }
  } else if (unlockType === PATTERN_UNLOCK) {
    if (!/^[1-9]{2,9}$/.test(_lodash.default.trim(unlockKey))) {
      throw new Error(`Unlock key value '${unlockKey}' must only include from two to nine digits in range 1..9`);
    }
    if (/([1-9]).*?\1/.test(_lodash.default.trim(unlockKey))) {
      throw new Error(`Unlock key value '${unlockKey}' must define a valid pattern where repeats are not allowed`);
    }
  } else if (unlockType === PASSWORD_UNLOCK) {
    if (!/.{4,}/g.test(unlockKey)) {
      throw new Error(`The minimum allowed length of unlock key value '${unlockKey}' is 4 characters`);
    }
  } else {
    throw new Error(`Invalid unlock type '${unlockType}'. ` + `Only the following unlock types are supported: ${UNLOCK_TYPES}`);
  }
  return caps;
};
helpers.fastUnlock = async function fastUnlock(adb, opts = {}) {
  const {
    credential,
    credentialType
  } = opts;
  _logger.default.info(`Unlocking the device via ADB using ${credentialType} credential '${credential}'`);
  const wasLockEnabled = await adb.isLockEnabled();
  if (wasLockEnabled) {
    await adb.clearLockCredential(credential);
    await adb.cycleWakeUp();
  } else {
    _logger.default.info('No active lock has been detected. Proceeding to the keyguard dismissal');
  }
  try {
    await adb.dismissKeyguard();
  } finally {
    if (wasLockEnabled) {
      await adb.setLockCredential(credentialType, credential);
    }
  }
};
helpers.encodePassword = function encodePassword(key) {
  return `${key}`.replace(/\s/ig, '%s');
};
helpers.stringKeyToArr = function stringKeyToArr(key) {
  return `${key}`.trim().replace(/\s+/g, '').split(/\s*/);
};
helpers.fingerprintUnlock = async function fingerprintUnlock(adb, driver, capabilities) {
  if ((await adb.getApiLevel()) < 23) {
    throw new Error('Fingerprint unlock only works for Android 6+ emulators');
  }
  await adb.fingerprint(capabilities.unlockKey);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
};
helpers.pinUnlock = async function pinUnlock(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using pin ${capabilities.unlockKey}`);
  await adb.dismissKeyguard();
  const keys = helpers.stringKeyToArr(capabilities.unlockKey);
  if ((await adb.getApiLevel()) >= 21) {
    const els = await driver.findElOrEls('id', 'com.android.systemui:id/digit_text', true);
    if (_lodash.default.isEmpty(els)) {
      return await helpers.pinUnlockWithKeyEvent(adb, driver, capabilities);
    }
    const pins = {};
    for (const el of els) {
      const text = await driver.getAttribute('text', _support.util.unwrapElement(el));
      pins[text] = el;
    }
    for (const pin of keys) {
      const el = pins[pin];
      await driver.click(_support.util.unwrapElement(el));
    }
  } else {
    for (const pin of keys) {
      const el = await driver.findElOrEls('id', `com.android.keyguard:id/key${pin}`, false);
      if (el === null) {
        return await helpers.pinUnlockWithKeyEvent(adb, driver, capabilities);
      }
      await driver.click(_support.util.unwrapElement(el));
    }
  }
  await waitForUnlock(adb);
};
async function waitForUnlock(adb) {
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
  if (!(await adb.isScreenLocked())) {
    return;
  }
  await adb.keyevent(KEYCODE_NUMPAD_ENTER);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
}
helpers.pinUnlockWithKeyEvent = async function pinUnlockWithKeyEvent(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using pin with keycode ${capabilities.unlockKey}`);
  await adb.dismissKeyguard();
  const keys = helpers.stringKeyToArr(capabilities.unlockKey);
  for (const pin of keys) {
    await adb.shell(['input', 'keyevent', parseInt(pin, 10) + NUMBER_ZERO_KEYCODE]);
  }
  await waitForUnlock(adb, driver);
};
helpers.passwordUnlock = async function passwordUnlock(adb, driver, capabilities) {
  const {
    unlockKey
  } = capabilities;
  _logger.default.info(`Trying to unlock device using password ${unlockKey}`);
  await adb.dismissKeyguard();
  const key = helpers.encodePassword(unlockKey);
  await adb.shell(['input', 'text', key]);
  await (0, _asyncbox.sleep)(INPUT_KEYS_WAIT_TIME);
  await adb.shell(['input', 'keyevent', KEYCODE_NUMPAD_ENTER]);
  await waitForUnlock(adb, driver);
};
helpers.getPatternKeyPosition = function getPatternKeyPosition(key, initPos, piece) {
  const cols = 3;
  const pins = 9;
  const xPos = (key, x, piece) => Math.round(x + (key % cols || cols) * piece - piece / 2);
  const yPos = (key, y, piece) => Math.round(y + (Math.ceil((key % pins || pins) / cols) * piece - piece / 2));
  return {
    x: xPos(key, initPos.x, piece),
    y: yPos(key, initPos.y, piece)
  };
};
helpers.getPatternActions = function getPatternActions(keys, initPos, piece) {
  const actions = [];
  let lastPos;
  for (let key of keys) {
    const keyPos = helpers.getPatternKeyPosition(key, initPos, piece);
    if (key === keys[0]) {
      actions.push({
        action: 'press',
        options: {
          element: null,
          x: keyPos.x,
          y: keyPos.y
        }
      });
      lastPos = keyPos;
      continue;
    }
    const moveTo = {
      x: 0,
      y: 0
    };
    const diffX = keyPos.x - lastPos.x;
    if (diffX > 0) {
      moveTo.x = piece;
      if (Math.abs(diffX) > piece) {
        moveTo.x += piece;
      }
    } else if (diffX < 0) {
      moveTo.x = -1 * piece;
      if (Math.abs(diffX) > piece) {
        moveTo.x -= piece;
      }
    }
    const diffY = keyPos.y - lastPos.y;
    if (diffY > 0) {
      moveTo.y = piece;
      if (Math.abs(diffY) > piece) {
        moveTo.y += piece;
      }
    } else if (diffY < 0) {
      moveTo.y = -1 * piece;
      if (Math.abs(diffY) > piece) {
        moveTo.y -= piece;
      }
    }
    actions.push({
      action: 'moveTo',
      options: {
        element: null,
        x: moveTo.x + lastPos.x,
        y: moveTo.y + lastPos.y
      }
    });
    lastPos = keyPos;
  }
  actions.push({
    action: 'release'
  });
  return actions;
};
helpers.patternUnlock = async function patternUnlock(adb, driver, capabilities) {
  const {
    unlockKey
  } = capabilities;
  _logger.default.info(`Trying to unlock device using pattern ${unlockKey}`);
  await adb.dismissKeyguard();
  const keys = helpers.stringKeyToArr(unlockKey);
  const apiLevel = await adb.getApiLevel();
  const el = await driver.findElOrEls('id', `com.android.${apiLevel >= 21 ? 'systemui' : 'keyguard'}:id/lockPatternView`, false);
  const initPos = await driver.getLocation(_support.util.unwrapElement(el));
  const size = await driver.getSize(_support.util.unwrapElement(el));
  const actions = helpers.getPatternActions(keys, initPos, size.width / 3);
  await driver.performTouch(actions);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
};
helpers.PIN_UNLOCK = PIN_UNLOCK;
helpers.PIN_UNLOCK_KEY_EVENT = PIN_UNLOCK_KEY_EVENT;
helpers.PASSWORD_UNLOCK = PASSWORD_UNLOCK;
helpers.PATTERN_UNLOCK = PATTERN_UNLOCK;
helpers.FINGERPRINT_UNLOCK = FINGERPRINT_UNLOCK;
var _default = helpers;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQSU5fVU5MT0NLIiwiUElOX1VOTE9DS19LRVlfRVZFTlQiLCJQQVNTV09SRF9VTkxPQ0siLCJQQVRURVJOX1VOTE9DSyIsIkZJTkdFUlBSSU5UX1VOTE9DSyIsIlVOTE9DS19UWVBFUyIsIktFWUNPREVfTlVNUEFEX0VOVEVSIiwiVU5MT0NLX1dBSVRfVElNRSIsIklOUFVUX0tFWVNfV0FJVF9USU1FIiwiTlVNQkVSX1pFUk9fS0VZQ09ERSIsImhlbHBlcnMiLCJ2YWxpZGF0ZVVubG9ja0NhcGFiaWxpdGllcyIsImNhcHMiLCJ1bmxvY2tLZXkiLCJ1bmxvY2tUeXBlIiwiXyIsImlzTmlsIiwiRXJyb3IiLCJpbmNsdWRlcyIsInRlc3QiLCJ0cmltIiwiZmFzdFVubG9jayIsImFkYiIsIm9wdHMiLCJjcmVkZW50aWFsIiwiY3JlZGVudGlhbFR5cGUiLCJsb2dnZXIiLCJpbmZvIiwid2FzTG9ja0VuYWJsZWQiLCJpc0xvY2tFbmFibGVkIiwiY2xlYXJMb2NrQ3JlZGVudGlhbCIsImN5Y2xlV2FrZVVwIiwiZGlzbWlzc0tleWd1YXJkIiwic2V0TG9ja0NyZWRlbnRpYWwiLCJlbmNvZGVQYXNzd29yZCIsImtleSIsInJlcGxhY2UiLCJzdHJpbmdLZXlUb0FyciIsInNwbGl0IiwiZmluZ2VycHJpbnRVbmxvY2siLCJkcml2ZXIiLCJjYXBhYmlsaXRpZXMiLCJnZXRBcGlMZXZlbCIsImZpbmdlcnByaW50Iiwic2xlZXAiLCJwaW5VbmxvY2siLCJrZXlzIiwiZWxzIiwiZmluZEVsT3JFbHMiLCJpc0VtcHR5IiwicGluVW5sb2NrV2l0aEtleUV2ZW50IiwicGlucyIsImVsIiwidGV4dCIsImdldEF0dHJpYnV0ZSIsInV0aWwiLCJ1bndyYXBFbGVtZW50IiwicGluIiwiY2xpY2siLCJ3YWl0Rm9yVW5sb2NrIiwiaXNTY3JlZW5Mb2NrZWQiLCJrZXlldmVudCIsInNoZWxsIiwicGFyc2VJbnQiLCJwYXNzd29yZFVubG9jayIsImdldFBhdHRlcm5LZXlQb3NpdGlvbiIsImluaXRQb3MiLCJwaWVjZSIsImNvbHMiLCJ4UG9zIiwieCIsIk1hdGgiLCJyb3VuZCIsInlQb3MiLCJ5IiwiY2VpbCIsImdldFBhdHRlcm5BY3Rpb25zIiwiYWN0aW9ucyIsImxhc3RQb3MiLCJrZXlQb3MiLCJwdXNoIiwiYWN0aW9uIiwib3B0aW9ucyIsImVsZW1lbnQiLCJtb3ZlVG8iLCJkaWZmWCIsImFicyIsImRpZmZZIiwicGF0dGVyblVubG9jayIsImFwaUxldmVsIiwiZ2V0TG9jYXRpb24iLCJzaXplIiwiZ2V0U2l6ZSIsIndpZHRoIiwicGVyZm9ybVRvdWNoIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL3VubG9jay1oZWxwZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgc2xlZXAgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cbmNvbnN0IFBJTl9VTkxPQ0sgPSAncGluJztcbmNvbnN0IFBJTl9VTkxPQ0tfS0VZX0VWRU5UID0gJ3BpbldpdGhLZXlFdmVudCc7XG5jb25zdCBQQVNTV09SRF9VTkxPQ0sgPSAncGFzc3dvcmQnO1xuY29uc3QgUEFUVEVSTl9VTkxPQ0sgPSAncGF0dGVybic7XG5jb25zdCBGSU5HRVJQUklOVF9VTkxPQ0sgPSAnZmluZ2VycHJpbnQnO1xuY29uc3QgVU5MT0NLX1RZUEVTID0gW1xuICBQSU5fVU5MT0NLLCBQSU5fVU5MT0NLX0tFWV9FVkVOVCwgUEFTU1dPUkRfVU5MT0NLLFxuICBQQVRURVJOX1VOTE9DSywgRklOR0VSUFJJTlRfVU5MT0NLXG5dO1xuY29uc3QgS0VZQ09ERV9OVU1QQURfRU5URVIgPSA2NjtcbmNvbnN0IFVOTE9DS19XQUlUX1RJTUUgPSAxMDA7XG5jb25zdCBJTlBVVF9LRVlTX1dBSVRfVElNRSA9IDEwMDtcbmNvbnN0IE5VTUJFUl9aRVJPX0tFWUNPREUgPSA3O1xuXG5jb25zdCBoZWxwZXJzID0ge307XG5cbmhlbHBlcnMudmFsaWRhdGVVbmxvY2tDYXBhYmlsaXRpZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZVVubG9ja0NhcGFiaWxpdGllcyAoY2FwcyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICB1bmxvY2tLZXksXG4gICAgdW5sb2NrVHlwZSxcbiAgfSA9IGNhcHM7XG4gIGlmIChfLmlzTmlsKHVubG9ja0tleSkgfHwgdW5sb2NrS2V5ID09PSAnJykge1xuICAgIHRocm93IG5ldyBFcnJvcignQSBub24tZW1wdHkgdW5sb2NrIGtleSB2YWx1ZSBtdXN0IGJlIHByb3ZpZGVkJyk7XG4gIH1cblxuICBpZiAoW1BJTl9VTkxPQ0ssIFBJTl9VTkxPQ0tfS0VZX0VWRU5ULCBGSU5HRVJQUklOVF9VTkxPQ0tdLmluY2x1ZGVzKHVubG9ja1R5cGUpKSB7XG4gICAgaWYgKCEvXlswLTldKyQvLnRlc3QoXy50cmltKHVubG9ja0tleSkpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVubG9jayBrZXkgdmFsdWUgJyR7dW5sb2NrS2V5fScgbXVzdCBvbmx5IGNvbnNpc3Qgb2YgZGlnaXRzYCk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHVubG9ja1R5cGUgPT09IFBBVFRFUk5fVU5MT0NLKSB7XG4gICAgaWYgKCEvXlsxLTldezIsOX0kLy50ZXN0KF8udHJpbSh1bmxvY2tLZXkpKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmxvY2sga2V5IHZhbHVlICcke3VubG9ja0tleX0nIG11c3Qgb25seSBpbmNsdWRlIGZyb20gdHdvIHRvIG5pbmUgZGlnaXRzIGluIHJhbmdlIDEuLjlgKTtcbiAgICB9XG4gICAgaWYgKC8oWzEtOV0pLio/XFwxLy50ZXN0KF8udHJpbSh1bmxvY2tLZXkpKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmxvY2sga2V5IHZhbHVlICcke3VubG9ja0tleX0nIG11c3QgZGVmaW5lIGEgdmFsaWQgcGF0dGVybiB3aGVyZSByZXBlYXRzIGFyZSBub3QgYWxsb3dlZGApO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1bmxvY2tUeXBlID09PSBQQVNTV09SRF9VTkxPQ0spIHtcbiAgICAvLyBEb250IHRyaW0gcGFzc3dvcmQga2V5LCB5b3UgY2FuIHVzZSBibGFuayBzcGFjZXMgaW4geW91ciBhbmRyb2lkIHBhc3N3b3JkXG4gICAgLy8gwq9cXF8o44OEKV8vwq9cbiAgICBpZiAoIS8uezQsfS9nLnRlc3QodW5sb2NrS2V5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbWluaW11bSBhbGxvd2VkIGxlbmd0aCBvZiB1bmxvY2sga2V5IHZhbHVlICcke3VubG9ja0tleX0nIGlzIDQgY2hhcmFjdGVyc2ApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdW5sb2NrIHR5cGUgJyR7dW5sb2NrVHlwZX0nLiBgICtcbiAgICAgIGBPbmx5IHRoZSBmb2xsb3dpbmcgdW5sb2NrIHR5cGVzIGFyZSBzdXBwb3J0ZWQ6ICR7VU5MT0NLX1RZUEVTfWApO1xuICB9XG4gIHJldHVybiBjYXBzO1xufTtcblxuaGVscGVycy5mYXN0VW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gZmFzdFVubG9jayAoYWRiLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGNyZWRlbnRpYWwsXG4gICAgY3JlZGVudGlhbFR5cGUsXG4gIH0gPSBvcHRzO1xuICBsb2dnZXIuaW5mbyhgVW5sb2NraW5nIHRoZSBkZXZpY2UgdmlhIEFEQiB1c2luZyAke2NyZWRlbnRpYWxUeXBlfSBjcmVkZW50aWFsICcke2NyZWRlbnRpYWx9J2ApO1xuICBjb25zdCB3YXNMb2NrRW5hYmxlZCA9IGF3YWl0IGFkYi5pc0xvY2tFbmFibGVkKCk7XG4gIGlmICh3YXNMb2NrRW5hYmxlZCkge1xuICAgIGF3YWl0IGFkYi5jbGVhckxvY2tDcmVkZW50aWFsKGNyZWRlbnRpYWwpO1xuICAgIC8vIG5vdCBzdXJlIHdoeSwgYnV0IHRoZSBkZXZpY2UncyBzY3JlZW4gc3RpbGwgcmVtYWlucyBsb2NrZWRcbiAgICAvLyBpZiBhIHByZWxpbWluYXJ5IHdha2UgdXAgY3ljbGUgaGFzIG5vdCBiZWVuIHBlcmZvcm1lZFxuICAgIGF3YWl0IGFkYi5jeWNsZVdha2VVcCgpO1xuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5pbmZvKCdObyBhY3RpdmUgbG9jayBoYXMgYmVlbiBkZXRlY3RlZC4gUHJvY2VlZGluZyB0byB0aGUga2V5Z3VhcmQgZGlzbWlzc2FsJyk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCBhZGIuZGlzbWlzc0tleWd1YXJkKCk7XG4gIH0gZmluYWxseSB7XG4gICAgaWYgKHdhc0xvY2tFbmFibGVkKSB7XG4gICAgICBhd2FpdCBhZGIuc2V0TG9ja0NyZWRlbnRpYWwoY3JlZGVudGlhbFR5cGUsIGNyZWRlbnRpYWwpO1xuICAgIH1cbiAgfVxufTtcblxuaGVscGVycy5lbmNvZGVQYXNzd29yZCA9IGZ1bmN0aW9uIGVuY29kZVBhc3N3b3JkIChrZXkpIHtcbiAgcmV0dXJuIGAke2tleX1gLnJlcGxhY2UoL1xccy9pZywgJyVzJyk7XG59O1xuXG5oZWxwZXJzLnN0cmluZ0tleVRvQXJyID0gZnVuY3Rpb24gc3RyaW5nS2V5VG9BcnIgKGtleSkge1xuICByZXR1cm4gYCR7a2V5fWAudHJpbSgpLnJlcGxhY2UoL1xccysvZywgJycpLnNwbGl0KC9cXHMqLyk7XG59O1xuXG5oZWxwZXJzLmZpbmdlcnByaW50VW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gZmluZ2VycHJpbnRVbmxvY2sgKGFkYiwgZHJpdmVyLCBjYXBhYmlsaXRpZXMpIHtcbiAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbmdlcnByaW50IHVubG9jayBvbmx5IHdvcmtzIGZvciBBbmRyb2lkIDYrIGVtdWxhdG9ycycpO1xuICB9XG4gIGF3YWl0IGFkYi5maW5nZXJwcmludChjYXBhYmlsaXRpZXMudW5sb2NrS2V5KTtcbiAgYXdhaXQgc2xlZXAoVU5MT0NLX1dBSVRfVElNRSk7XG59O1xuXG5oZWxwZXJzLnBpblVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIHBpblVubG9jayAoYWRiLCBkcml2ZXIsIGNhcGFiaWxpdGllcykge1xuICBsb2dnZXIuaW5mbyhgVHJ5aW5nIHRvIHVubG9jayBkZXZpY2UgdXNpbmcgcGluICR7Y2FwYWJpbGl0aWVzLnVubG9ja0tleX1gKTtcbiAgYXdhaXQgYWRiLmRpc21pc3NLZXlndWFyZCgpO1xuICBjb25zdCBrZXlzID0gaGVscGVycy5zdHJpbmdLZXlUb0FycihjYXBhYmlsaXRpZXMudW5sb2NrS2V5KTtcbiAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpID49IDIxKSB7XG4gICAgY29uc3QgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCdpZCcsICdjb20uYW5kcm9pZC5zeXN0ZW11aTppZC9kaWdpdF90ZXh0JywgdHJ1ZSk7XG4gICAgaWYgKF8uaXNFbXB0eShlbHMpKSB7XG4gICAgICAvLyBmYWxsYmFjayB0byBwaW4gd2l0aCBrZXkgZXZlbnRcbiAgICAgIHJldHVybiBhd2FpdCBoZWxwZXJzLnBpblVubG9ja1dpdGhLZXlFdmVudChhZGIsIGRyaXZlciwgY2FwYWJpbGl0aWVzKTtcbiAgICB9XG4gICAgY29uc3QgcGlucyA9IHt9O1xuICAgIGZvciAoY29uc3QgZWwgb2YgZWxzKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgndGV4dCcsIHV0aWwudW53cmFwRWxlbWVudChlbCkpO1xuICAgICAgcGluc1t0ZXh0XSA9IGVsO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHBpbiBvZiBrZXlzKSB7XG4gICAgICBjb25zdCBlbCA9IHBpbnNbcGluXTtcbiAgICAgIGF3YWl0IGRyaXZlci5jbGljayh1dGlsLnVud3JhcEVsZW1lbnQoZWwpKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZm9yIChjb25zdCBwaW4gb2Yga2V5cykge1xuICAgICAgY29uc3QgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsT3JFbHMoJ2lkJywgYGNvbS5hbmRyb2lkLmtleWd1YXJkOmlkL2tleSR7cGlufWAsIGZhbHNlKTtcbiAgICAgIGlmIChlbCA9PT0gbnVsbCkge1xuICAgICAgICAvLyBmYWxsYmFjayB0byBwaW4gd2l0aCBrZXkgZXZlbnRcbiAgICAgICAgcmV0dXJuIGF3YWl0IGhlbHBlcnMucGluVW5sb2NrV2l0aEtleUV2ZW50KGFkYiwgZHJpdmVyLCBjYXBhYmlsaXRpZXMpO1xuICAgICAgfVxuICAgICAgYXdhaXQgZHJpdmVyLmNsaWNrKHV0aWwudW53cmFwRWxlbWVudChlbCkpO1xuICAgIH1cbiAgfVxuICBhd2FpdCB3YWl0Rm9yVW5sb2NrKGFkYik7XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBkaXNwbGF5IHRvIGJlIHVubG9ja2VkLlxuICogU29tZSBkZXZpY2VzIGF1dG9tYXRpY2FsbHkgYWNjZXB0IHR5cGVkICdwaW4nIGFuZCAncGFzc3dvcmQnIGNvZGVcbiAqIHdpdGhvdXQgcHJlc3NpbmcgdGhlIEVudGVyIGtleS4gQnV0IHNvbWUgZGV2aWNlcyBuZWVkIGl0LlxuICogVGhpcyBtZXRob2Qgd2FpdHMgYSBmZXcgc2Vjb25kcyBmaXJzdCBmb3Igc3VjaCBhdXRvbWF0aWMgYWNjZXB0YW5jZSBjYXNlLlxuICogSWYgdGhlIGRldmljZSBpcyBzdGlsbCBsb2NrZWQsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCB0cnkgdG8gc2VuZFxuICogdGhlIGVudGVyIGtleSBjb2RlLlxuICpcbiAqIEBwYXJhbSB7QURCfSBhZGIgVGhlIGluc3RhbmNlIG9mIEFEQlxuICovXG5hc3luYyBmdW5jdGlvbiB3YWl0Rm9yVW5sb2NrIChhZGIpIHtcbiAgYXdhaXQgc2xlZXAoVU5MT0NLX1dBSVRfVElNRSk7XG4gIGlmICghYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBhd2FpdCBhZGIua2V5ZXZlbnQoS0VZQ09ERV9OVU1QQURfRU5URVIpO1xuICBhd2FpdCBzbGVlcChVTkxPQ0tfV0FJVF9USU1FKTtcbn1cblxuaGVscGVycy5waW5VbmxvY2tXaXRoS2V5RXZlbnQgPSBhc3luYyBmdW5jdGlvbiBwaW5VbmxvY2tXaXRoS2V5RXZlbnQgKGFkYiwgZHJpdmVyLCBjYXBhYmlsaXRpZXMpIHtcbiAgbG9nZ2VyLmluZm8oYFRyeWluZyB0byB1bmxvY2sgZGV2aWNlIHVzaW5nIHBpbiB3aXRoIGtleWNvZGUgJHtjYXBhYmlsaXRpZXMudW5sb2NrS2V5fWApO1xuICBhd2FpdCBhZGIuZGlzbWlzc0tleWd1YXJkKCk7XG4gIGNvbnN0IGtleXMgPSBoZWxwZXJzLnN0cmluZ0tleVRvQXJyKGNhcGFiaWxpdGllcy51bmxvY2tLZXkpO1xuXG4gIC8vIFNvbWUgZGV2aWNlIGRvZXMgbm90IGhhdmUgc3lzdGVtIGtleSBpZHMgbGlrZSAnY29tLmFuZHJvaWQua2V5Z3VhcmQ6aWQva2V5J1xuICAvLyBUaGVuLCBzZW5kaW5nIGtleWV2ZW50cyBhcmUgbW9yZSByZWxpYWJsZSB0byB1bmxvY2sgdGhlIHNjcmVlbi5cbiAgZm9yIChjb25zdCBwaW4gb2Yga2V5cykge1xuICAgIC8vICdwaW4nIGlzIG51bWJlciAoMC05KSBpbiBzdHJpbmcuXG4gICAgLy8gTnVtYmVyICcwJyBpcyBrZXljb2RlICc3Jy4gbnVtYmVyICc5JyBpcyBrZXljb2RlICcxNicuXG4gICAgYXdhaXQgYWRiLnNoZWxsKFsnaW5wdXQnLCAna2V5ZXZlbnQnLCBwYXJzZUludChwaW4sIDEwKSArIE5VTUJFUl9aRVJPX0tFWUNPREVdKTtcbiAgfVxuICBhd2FpdCB3YWl0Rm9yVW5sb2NrKGFkYiwgZHJpdmVyKTtcbn07XG5cbmhlbHBlcnMucGFzc3dvcmRVbmxvY2sgPSBhc3luYyBmdW5jdGlvbiBwYXNzd29yZFVubG9jayAoYWRiLCBkcml2ZXIsIGNhcGFiaWxpdGllcykge1xuICBjb25zdCB7IHVubG9ja0tleSB9ID0gY2FwYWJpbGl0aWVzO1xuICBsb2dnZXIuaW5mbyhgVHJ5aW5nIHRvIHVubG9jayBkZXZpY2UgdXNpbmcgcGFzc3dvcmQgJHt1bmxvY2tLZXl9YCk7XG4gIGF3YWl0IGFkYi5kaXNtaXNzS2V5Z3VhcmQoKTtcbiAgLy8gUmVwbGFjZSBibGFuayBzcGFjZXMgd2l0aCAlc1xuICBjb25zdCBrZXkgPSBoZWxwZXJzLmVuY29kZVBhc3N3b3JkKHVubG9ja0tleSk7XG4gIC8vIFdoeSBhZGIgPyBJdCB3YXMgbGVzcyBmbGFreVxuICBhd2FpdCBhZGIuc2hlbGwoWydpbnB1dCcsICd0ZXh0Jywga2V5XSk7XG4gIC8vIFdoeSBzbGVlcHMgPyBBdm9pZCBzb21lIGZsYWt5bmVzcyB3YWl0aW5nIGZvciB0aGUgaW5wdXQgdG8gcmVjZWl2ZSB0aGUga2V5c1xuICBhd2FpdCBzbGVlcChJTlBVVF9LRVlTX1dBSVRfVElNRSk7XG4gIGF3YWl0IGFkYi5zaGVsbChbJ2lucHV0JywgJ2tleWV2ZW50JywgS0VZQ09ERV9OVU1QQURfRU5URVJdKTtcbiAgLy8gV2FpdHMgYSBiaXQgZm9yIHRoZSBkZXZpY2UgdG8gYmUgdW5sb2NrZWRcbiAgYXdhaXQgd2FpdEZvclVubG9jayhhZGIsIGRyaXZlcik7XG59O1xuXG5oZWxwZXJzLmdldFBhdHRlcm5LZXlQb3NpdGlvbiA9IGZ1bmN0aW9uIGdldFBhdHRlcm5LZXlQb3NpdGlvbiAoa2V5LCBpbml0UG9zLCBwaWVjZSkge1xuICAvKlxuICBIb3cgdGhlIG1hdGggd29ya3M6XG4gIFdlIGhhdmUgOSBidXR0b25zIGRpdmlkZWQgaW4gMyBjb2x1bW5zIGFuZCAzIHJvd3MgaW5zaWRlIHRoZSBsb2NrUGF0dGVyblZpZXcsXG4gIGV2ZXJ5IGJ1dHRvbiBoYXMgYSBwb3NpdGlvbiBvbiB0aGUgc2NyZWVuIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxvY2tQYXR0ZXJuVmlldyBzaW5jZVxuICBpdCBpcyB0aGUgcGFyZW50IHZpZXcgcmlnaHQgYXQgdGhlIG1pZGRsZSBvZiBlYWNoIGNvbHVtbiBvciByb3cuXG4gICovXG4gIGNvbnN0IGNvbHMgPSAzO1xuICBjb25zdCBwaW5zID0gOTtcbiAgY29uc3QgeFBvcyA9IChrZXksIHgsIHBpZWNlKSA9PiBNYXRoLnJvdW5kKHggKyAoKGtleSAlIGNvbHMpIHx8IGNvbHMpICogcGllY2UgLSBwaWVjZSAvIDIpO1xuICBjb25zdCB5UG9zID0gKGtleSwgeSwgcGllY2UpID0+IE1hdGgucm91bmQoeSArIChNYXRoLmNlaWwoKChrZXkgJSBwaW5zKSB8fCBwaW5zKSAvIGNvbHMpICogcGllY2UgLSBwaWVjZSAvIDIpKTtcbiAgcmV0dXJuIHtcbiAgICB4OiB4UG9zKGtleSwgaW5pdFBvcy54LCBwaWVjZSksXG4gICAgeTogeVBvcyhrZXksIGluaXRQb3MueSwgcGllY2UpXG4gIH07XG59O1xuXG5oZWxwZXJzLmdldFBhdHRlcm5BY3Rpb25zID0gZnVuY3Rpb24gZ2V0UGF0dGVybkFjdGlvbnMgKGtleXMsIGluaXRQb3MsIHBpZWNlKSB7XG4gIGNvbnN0IGFjdGlvbnMgPSBbXTtcbiAgbGV0IGxhc3RQb3M7XG4gIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgY29uc3Qga2V5UG9zID0gaGVscGVycy5nZXRQYXR0ZXJuS2V5UG9zaXRpb24oa2V5LCBpbml0UG9zLCBwaWVjZSk7XG4gICAgaWYgKGtleSA9PT0ga2V5c1swXSkge1xuICAgICAgYWN0aW9ucy5wdXNoKHthY3Rpb246ICdwcmVzcycsIG9wdGlvbnM6IHtlbGVtZW50OiBudWxsLCB4OiBrZXlQb3MueCwgeToga2V5UG9zLnl9fSk7XG4gICAgICBsYXN0UG9zID0ga2V5UG9zO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IG1vdmVUbyA9IHt4OiAwLCB5OiAwfTtcbiAgICBjb25zdCBkaWZmWCA9IGtleVBvcy54IC0gbGFzdFBvcy54O1xuICAgIGlmIChkaWZmWCA+IDApIHtcbiAgICAgIG1vdmVUby54ID0gcGllY2U7XG4gICAgICBpZiAoTWF0aC5hYnMoZGlmZlgpID4gcGllY2UpIHtcbiAgICAgICAgbW92ZVRvLnggKz0gcGllY2U7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkaWZmWCA8IDApIHtcbiAgICAgIG1vdmVUby54ID0gLTEgKiBwaWVjZTtcbiAgICAgIGlmIChNYXRoLmFicyhkaWZmWCkgPiBwaWVjZSkge1xuICAgICAgICBtb3ZlVG8ueCAtPSBwaWVjZTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgZGlmZlkgPSBrZXlQb3MueSAtIGxhc3RQb3MueTtcbiAgICBpZiAoZGlmZlkgPiAwKSB7XG4gICAgICBtb3ZlVG8ueSA9IHBpZWNlO1xuICAgICAgaWYgKE1hdGguYWJzKGRpZmZZKSA+IHBpZWNlKSB7XG4gICAgICAgIG1vdmVUby55ICs9IHBpZWNlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGlmZlkgPCAwKSB7XG4gICAgICBtb3ZlVG8ueSA9IC0xICogcGllY2U7XG4gICAgICBpZiAoTWF0aC5hYnMoZGlmZlkpID4gcGllY2UpIHtcbiAgICAgICAgbW92ZVRvLnkgLT0gcGllY2U7XG4gICAgICB9XG4gICAgfVxuICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICBhY3Rpb246ICdtb3ZlVG8nLFxuICAgICAgb3B0aW9uczoge2VsZW1lbnQ6IG51bGwsIHg6IG1vdmVUby54ICsgbGFzdFBvcy54LCB5OiBtb3ZlVG8ueSArIGxhc3RQb3MueX1cbiAgICB9KTtcbiAgICBsYXN0UG9zID0ga2V5UG9zO1xuICB9XG4gIGFjdGlvbnMucHVzaCh7YWN0aW9uOiAncmVsZWFzZSd9KTtcbiAgcmV0dXJuIGFjdGlvbnM7XG59O1xuXG5oZWxwZXJzLnBhdHRlcm5VbmxvY2sgPSBhc3luYyBmdW5jdGlvbiBwYXR0ZXJuVW5sb2NrIChhZGIsIGRyaXZlciwgY2FwYWJpbGl0aWVzKSB7XG4gIGNvbnN0IHsgdW5sb2NrS2V5IH0gPSBjYXBhYmlsaXRpZXM7XG4gIGxvZ2dlci5pbmZvKGBUcnlpbmcgdG8gdW5sb2NrIGRldmljZSB1c2luZyBwYXR0ZXJuICR7dW5sb2NrS2V5fWApO1xuICBhd2FpdCBhZGIuZGlzbWlzc0tleWd1YXJkKCk7XG4gIGNvbnN0IGtleXMgPSBoZWxwZXJzLnN0cmluZ0tleVRvQXJyKHVubG9ja0tleSk7XG4gIC8qIFdlIHNldCB0aGUgZGV2aWNlIHBhdHRlcm4gYnV0dG9ucyBhcyBudW1iZXIgb2YgYSByZWd1bGFyIHBob25lXG4gICAqICB8IOKAoiDigKIg4oCiIHwgICAgIHwgMSAyIDMgfFxuICAgKiAgfCDigKIg4oCiIOKAoiB8IC0tPiB8IDQgNSA2IHxcbiAgICogIHwg4oCiIOKAoiDigKIgfCAgICAgfCA3IDggOSB8XG5cbiAgVGhlIHBhdHRlcm4gdmlldyBidXR0b25zIGFyZSBub3Qgc2VlaW5nIGJ5IHRoZSB1aWF1dG9tYXRvciBzaW5jZSB0aGV5IGFyZVxuICBpbmNsdWRlZCBpbnNpZGUgYSBGcmFtZUxheW91dCwgc28gd2UgYXJlIGdvaW5nIHRvIHRyeSBjbGlja2luZyBvbiB0aGUgYnV0dG9uc1xuICB1c2luZyB0aGUgcGFyZW50IHZpZXcgYm91bmRzIGFuZCBtYXRoLlxuICAqL1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpO1xuICBjb25zdCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxPckVscygnaWQnLFxuICAgIGBjb20uYW5kcm9pZC4ke2FwaUxldmVsID49IDIxID8gJ3N5c3RlbXVpJyA6ICdrZXlndWFyZCd9OmlkL2xvY2tQYXR0ZXJuVmlld2AsXG4gICAgZmFsc2VcbiAgKTtcbiAgY29uc3QgaW5pdFBvcyA9IGF3YWl0IGRyaXZlci5nZXRMb2NhdGlvbih1dGlsLnVud3JhcEVsZW1lbnQoZWwpKTtcbiAgY29uc3Qgc2l6ZSA9IGF3YWl0IGRyaXZlci5nZXRTaXplKHV0aWwudW53cmFwRWxlbWVudChlbCkpO1xuICAvLyBHZXQgYWN0aW9ucyB0byBwZXJmb3JtXG4gIGNvbnN0IGFjdGlvbnMgPSBoZWxwZXJzLmdldFBhdHRlcm5BY3Rpb25zKGtleXMsIGluaXRQb3MsIHNpemUud2lkdGggLyAzKTtcbiAgLy8gUGVyZm9ybSBnZXN0dXJlXG4gIGF3YWl0IGRyaXZlci5wZXJmb3JtVG91Y2goYWN0aW9ucyk7XG4gIC8vIFdhaXRzIGEgYml0IGZvciB0aGUgZGV2aWNlIHRvIGJlIHVubG9ja2VkXG4gIGF3YWl0IHNsZWVwKFVOTE9DS19XQUlUX1RJTUUpO1xufTtcblxuaGVscGVycy5QSU5fVU5MT0NLID0gUElOX1VOTE9DSztcbmhlbHBlcnMuUElOX1VOTE9DS19LRVlfRVZFTlQgPSBQSU5fVU5MT0NLX0tFWV9FVkVOVDtcbmhlbHBlcnMuUEFTU1dPUkRfVU5MT0NLID0gUEFTU1dPUkRfVU5MT0NLO1xuaGVscGVycy5QQVRURVJOX1VOTE9DSyA9IFBBVFRFUk5fVU5MT0NLO1xuaGVscGVycy5GSU5HRVJQUklOVF9VTkxPQ0sgPSBGSU5HRVJQUklOVF9VTkxPQ0s7XG5cbmV4cG9ydCB7XG4gIFBJTl9VTkxPQ0ssIFBJTl9VTkxPQ0tfS0VZX0VWRU5ULCBQQVNTV09SRF9VTkxPQ0ssIFBBVFRFUk5fVU5MT0NLLFxuICBGSU5HRVJQUklOVF9VTkxPQ0ssIGhlbHBlcnNcbn07XG5leHBvcnQgZGVmYXVsdCBoZWxwZXJzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsTUFBTUEsVUFBVSxHQUFHLEtBQUs7QUFBQztBQUN6QixNQUFNQyxvQkFBb0IsR0FBRyxpQkFBaUI7QUFBQztBQUMvQyxNQUFNQyxlQUFlLEdBQUcsVUFBVTtBQUFDO0FBQ25DLE1BQU1DLGNBQWMsR0FBRyxTQUFTO0FBQUM7QUFDakMsTUFBTUMsa0JBQWtCLEdBQUcsYUFBYTtBQUFDO0FBQ3pDLE1BQU1DLFlBQVksR0FBRyxDQUNuQkwsVUFBVSxFQUFFQyxvQkFBb0IsRUFBRUMsZUFBZSxFQUNqREMsY0FBYyxFQUFFQyxrQkFBa0IsQ0FDbkM7QUFDRCxNQUFNRSxvQkFBb0IsR0FBRyxFQUFFO0FBQy9CLE1BQU1DLGdCQUFnQixHQUFHLEdBQUc7QUFDNUIsTUFBTUMsb0JBQW9CLEdBQUcsR0FBRztBQUNoQyxNQUFNQyxtQkFBbUIsR0FBRyxDQUFDO0FBRTdCLE1BQU1DLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFBQztBQUVuQkEsT0FBTyxDQUFDQywwQkFBMEIsR0FBRyxTQUFTQSwwQkFBMEIsQ0FBRUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQ25GLE1BQU07SUFDSkMsU0FBUztJQUNUQztFQUNGLENBQUMsR0FBR0YsSUFBSTtFQUNSLElBQUlHLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDSCxTQUFTLENBQUMsSUFBSUEsU0FBUyxLQUFLLEVBQUUsRUFBRTtJQUMxQyxNQUFNLElBQUlJLEtBQUssQ0FBQywrQ0FBK0MsQ0FBQztFQUNsRTtFQUVBLElBQUksQ0FBQ2pCLFVBQVUsRUFBRUMsb0JBQW9CLEVBQUVHLGtCQUFrQixDQUFDLENBQUNjLFFBQVEsQ0FBQ0osVUFBVSxDQUFDLEVBQUU7SUFDL0UsSUFBSSxDQUFDLFVBQVUsQ0FBQ0ssSUFBSSxDQUFDSixlQUFDLENBQUNLLElBQUksQ0FBQ1AsU0FBUyxDQUFDLENBQUMsRUFBRTtNQUN2QyxNQUFNLElBQUlJLEtBQUssQ0FBRSxxQkFBb0JKLFNBQVUsK0JBQThCLENBQUM7SUFDaEY7RUFDRixDQUFDLE1BQU0sSUFBSUMsVUFBVSxLQUFLWCxjQUFjLEVBQUU7SUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQ2dCLElBQUksQ0FBQ0osZUFBQyxDQUFDSyxJQUFJLENBQUNQLFNBQVMsQ0FBQyxDQUFDLEVBQUU7TUFDM0MsTUFBTSxJQUFJSSxLQUFLLENBQUUscUJBQW9CSixTQUFVLDJEQUEwRCxDQUFDO0lBQzVHO0lBQ0EsSUFBSSxjQUFjLENBQUNNLElBQUksQ0FBQ0osZUFBQyxDQUFDSyxJQUFJLENBQUNQLFNBQVMsQ0FBQyxDQUFDLEVBQUU7TUFDMUMsTUFBTSxJQUFJSSxLQUFLLENBQUUscUJBQW9CSixTQUFVLDZEQUE0RCxDQUFDO0lBQzlHO0VBQ0YsQ0FBQyxNQUFNLElBQUlDLFVBQVUsS0FBS1osZUFBZSxFQUFFO0lBR3pDLElBQUksQ0FBQyxRQUFRLENBQUNpQixJQUFJLENBQUNOLFNBQVMsQ0FBQyxFQUFFO01BQzdCLE1BQU0sSUFBSUksS0FBSyxDQUFFLG1EQUFrREosU0FBVSxtQkFBa0IsQ0FBQztJQUNsRztFQUNGLENBQUMsTUFBTTtJQUNMLE1BQU0sSUFBSUksS0FBSyxDQUFFLHdCQUF1QkgsVUFBVyxLQUFJLEdBQ3BELGtEQUFpRFQsWUFBYSxFQUFDLENBQUM7RUFDckU7RUFDQSxPQUFPTyxJQUFJO0FBQ2IsQ0FBQztBQUVERixPQUFPLENBQUNXLFVBQVUsR0FBRyxlQUFlQSxVQUFVLENBQUVDLEdBQUcsRUFBRUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQzlELE1BQU07SUFDSkMsVUFBVTtJQUNWQztFQUNGLENBQUMsR0FBR0YsSUFBSTtFQUNSRyxlQUFNLENBQUNDLElBQUksQ0FBRSxzQ0FBcUNGLGNBQWUsZ0JBQWVELFVBQVcsR0FBRSxDQUFDO0VBQzlGLE1BQU1JLGNBQWMsR0FBRyxNQUFNTixHQUFHLENBQUNPLGFBQWEsRUFBRTtFQUNoRCxJQUFJRCxjQUFjLEVBQUU7SUFDbEIsTUFBTU4sR0FBRyxDQUFDUSxtQkFBbUIsQ0FBQ04sVUFBVSxDQUFDO0lBR3pDLE1BQU1GLEdBQUcsQ0FBQ1MsV0FBVyxFQUFFO0VBQ3pCLENBQUMsTUFBTTtJQUNMTCxlQUFNLENBQUNDLElBQUksQ0FBQyx3RUFBd0UsQ0FBQztFQUN2RjtFQUNBLElBQUk7SUFDRixNQUFNTCxHQUFHLENBQUNVLGVBQWUsRUFBRTtFQUM3QixDQUFDLFNBQVM7SUFDUixJQUFJSixjQUFjLEVBQUU7TUFDbEIsTUFBTU4sR0FBRyxDQUFDVyxpQkFBaUIsQ0FBQ1IsY0FBYyxFQUFFRCxVQUFVLENBQUM7SUFDekQ7RUFDRjtBQUNGLENBQUM7QUFFRGQsT0FBTyxDQUFDd0IsY0FBYyxHQUFHLFNBQVNBLGNBQWMsQ0FBRUMsR0FBRyxFQUFFO0VBQ3JELE9BQVEsR0FBRUEsR0FBSSxFQUFDLENBQUNDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDO0FBQ3ZDLENBQUM7QUFFRDFCLE9BQU8sQ0FBQzJCLGNBQWMsR0FBRyxTQUFTQSxjQUFjLENBQUVGLEdBQUcsRUFBRTtFQUNyRCxPQUFRLEdBQUVBLEdBQUksRUFBQyxDQUFDZixJQUFJLEVBQUUsQ0FBQ2dCLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUNFLEtBQUssQ0FBQyxLQUFLLENBQUM7QUFDekQsQ0FBQztBQUVENUIsT0FBTyxDQUFDNkIsaUJBQWlCLEdBQUcsZUFBZUEsaUJBQWlCLENBQUVqQixHQUFHLEVBQUVrQixNQUFNLEVBQUVDLFlBQVksRUFBRTtFQUN2RixJQUFJLE9BQU1uQixHQUFHLENBQUNvQixXQUFXLEVBQUUsSUFBRyxFQUFFLEVBQUU7SUFDaEMsTUFBTSxJQUFJekIsS0FBSyxDQUFDLHdEQUF3RCxDQUFDO0VBQzNFO0VBQ0EsTUFBTUssR0FBRyxDQUFDcUIsV0FBVyxDQUFDRixZQUFZLENBQUM1QixTQUFTLENBQUM7RUFDN0MsTUFBTSxJQUFBK0IsZUFBSyxFQUFDckMsZ0JBQWdCLENBQUM7QUFDL0IsQ0FBQztBQUVERyxPQUFPLENBQUNtQyxTQUFTLEdBQUcsZUFBZUEsU0FBUyxDQUFFdkIsR0FBRyxFQUFFa0IsTUFBTSxFQUFFQyxZQUFZLEVBQUU7RUFDdkVmLGVBQU0sQ0FBQ0MsSUFBSSxDQUFFLHFDQUFvQ2MsWUFBWSxDQUFDNUIsU0FBVSxFQUFDLENBQUM7RUFDMUUsTUFBTVMsR0FBRyxDQUFDVSxlQUFlLEVBQUU7RUFDM0IsTUFBTWMsSUFBSSxHQUFHcEMsT0FBTyxDQUFDMkIsY0FBYyxDQUFDSSxZQUFZLENBQUM1QixTQUFTLENBQUM7RUFDM0QsSUFBSSxPQUFNUyxHQUFHLENBQUNvQixXQUFXLEVBQUUsS0FBSSxFQUFFLEVBQUU7SUFDakMsTUFBTUssR0FBRyxHQUFHLE1BQU1QLE1BQU0sQ0FBQ1EsV0FBVyxDQUFDLElBQUksRUFBRSxvQ0FBb0MsRUFBRSxJQUFJLENBQUM7SUFDdEYsSUFBSWpDLGVBQUMsQ0FBQ2tDLE9BQU8sQ0FBQ0YsR0FBRyxDQUFDLEVBQUU7TUFFbEIsT0FBTyxNQUFNckMsT0FBTyxDQUFDd0MscUJBQXFCLENBQUM1QixHQUFHLEVBQUVrQixNQUFNLEVBQUVDLFlBQVksQ0FBQztJQUN2RTtJQUNBLE1BQU1VLElBQUksR0FBRyxDQUFDLENBQUM7SUFDZixLQUFLLE1BQU1DLEVBQUUsSUFBSUwsR0FBRyxFQUFFO01BQ3BCLE1BQU1NLElBQUksR0FBRyxNQUFNYixNQUFNLENBQUNjLFlBQVksQ0FBQyxNQUFNLEVBQUVDLGFBQUksQ0FBQ0MsYUFBYSxDQUFDSixFQUFFLENBQUMsQ0FBQztNQUN0RUQsSUFBSSxDQUFDRSxJQUFJLENBQUMsR0FBR0QsRUFBRTtJQUNqQjtJQUNBLEtBQUssTUFBTUssR0FBRyxJQUFJWCxJQUFJLEVBQUU7TUFDdEIsTUFBTU0sRUFBRSxHQUFHRCxJQUFJLENBQUNNLEdBQUcsQ0FBQztNQUNwQixNQUFNakIsTUFBTSxDQUFDa0IsS0FBSyxDQUFDSCxhQUFJLENBQUNDLGFBQWEsQ0FBQ0osRUFBRSxDQUFDLENBQUM7SUFDNUM7RUFDRixDQUFDLE1BQU07SUFDTCxLQUFLLE1BQU1LLEdBQUcsSUFBSVgsSUFBSSxFQUFFO01BQ3RCLE1BQU1NLEVBQUUsR0FBRyxNQUFNWixNQUFNLENBQUNRLFdBQVcsQ0FBQyxJQUFJLEVBQUcsOEJBQTZCUyxHQUFJLEVBQUMsRUFBRSxLQUFLLENBQUM7TUFDckYsSUFBSUwsRUFBRSxLQUFLLElBQUksRUFBRTtRQUVmLE9BQU8sTUFBTTFDLE9BQU8sQ0FBQ3dDLHFCQUFxQixDQUFDNUIsR0FBRyxFQUFFa0IsTUFBTSxFQUFFQyxZQUFZLENBQUM7TUFDdkU7TUFDQSxNQUFNRCxNQUFNLENBQUNrQixLQUFLLENBQUNILGFBQUksQ0FBQ0MsYUFBYSxDQUFDSixFQUFFLENBQUMsQ0FBQztJQUM1QztFQUNGO0VBQ0EsTUFBTU8sYUFBYSxDQUFDckMsR0FBRyxDQUFDO0FBQzFCLENBQUM7QUFZRCxlQUFlcUMsYUFBYSxDQUFFckMsR0FBRyxFQUFFO0VBQ2pDLE1BQU0sSUFBQXNCLGVBQUssRUFBQ3JDLGdCQUFnQixDQUFDO0VBQzdCLElBQUksRUFBQyxNQUFNZSxHQUFHLENBQUNzQyxjQUFjLEVBQUUsR0FBRTtJQUMvQjtFQUNGO0VBRUEsTUFBTXRDLEdBQUcsQ0FBQ3VDLFFBQVEsQ0FBQ3ZELG9CQUFvQixDQUFDO0VBQ3hDLE1BQU0sSUFBQXNDLGVBQUssRUFBQ3JDLGdCQUFnQixDQUFDO0FBQy9CO0FBRUFHLE9BQU8sQ0FBQ3dDLHFCQUFxQixHQUFHLGVBQWVBLHFCQUFxQixDQUFFNUIsR0FBRyxFQUFFa0IsTUFBTSxFQUFFQyxZQUFZLEVBQUU7RUFDL0ZmLGVBQU0sQ0FBQ0MsSUFBSSxDQUFFLGtEQUFpRGMsWUFBWSxDQUFDNUIsU0FBVSxFQUFDLENBQUM7RUFDdkYsTUFBTVMsR0FBRyxDQUFDVSxlQUFlLEVBQUU7RUFDM0IsTUFBTWMsSUFBSSxHQUFHcEMsT0FBTyxDQUFDMkIsY0FBYyxDQUFDSSxZQUFZLENBQUM1QixTQUFTLENBQUM7RUFJM0QsS0FBSyxNQUFNNEMsR0FBRyxJQUFJWCxJQUFJLEVBQUU7SUFHdEIsTUFBTXhCLEdBQUcsQ0FBQ3dDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUVDLFFBQVEsQ0FBQ04sR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHaEQsbUJBQW1CLENBQUMsQ0FBQztFQUNqRjtFQUNBLE1BQU1rRCxhQUFhLENBQUNyQyxHQUFHLEVBQUVrQixNQUFNLENBQUM7QUFDbEMsQ0FBQztBQUVEOUIsT0FBTyxDQUFDc0QsY0FBYyxHQUFHLGVBQWVBLGNBQWMsQ0FBRTFDLEdBQUcsRUFBRWtCLE1BQU0sRUFBRUMsWUFBWSxFQUFFO0VBQ2pGLE1BQU07SUFBRTVCO0VBQVUsQ0FBQyxHQUFHNEIsWUFBWTtFQUNsQ2YsZUFBTSxDQUFDQyxJQUFJLENBQUUsMENBQXlDZCxTQUFVLEVBQUMsQ0FBQztFQUNsRSxNQUFNUyxHQUFHLENBQUNVLGVBQWUsRUFBRTtFQUUzQixNQUFNRyxHQUFHLEdBQUd6QixPQUFPLENBQUN3QixjQUFjLENBQUNyQixTQUFTLENBQUM7RUFFN0MsTUFBTVMsR0FBRyxDQUFDd0MsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRTNCLEdBQUcsQ0FBQyxDQUFDO0VBRXZDLE1BQU0sSUFBQVMsZUFBSyxFQUFDcEMsb0JBQW9CLENBQUM7RUFDakMsTUFBTWMsR0FBRyxDQUFDd0MsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRXhELG9CQUFvQixDQUFDLENBQUM7RUFFNUQsTUFBTXFELGFBQWEsQ0FBQ3JDLEdBQUcsRUFBRWtCLE1BQU0sQ0FBQztBQUNsQyxDQUFDO0FBRUQ5QixPQUFPLENBQUN1RCxxQkFBcUIsR0FBRyxTQUFTQSxxQkFBcUIsQ0FBRTlCLEdBQUcsRUFBRStCLE9BQU8sRUFBRUMsS0FBSyxFQUFFO0VBT25GLE1BQU1DLElBQUksR0FBRyxDQUFDO0VBQ2QsTUFBTWpCLElBQUksR0FBRyxDQUFDO0VBQ2QsTUFBTWtCLElBQUksR0FBRyxDQUFDbEMsR0FBRyxFQUFFbUMsQ0FBQyxFQUFFSCxLQUFLLEtBQUtJLElBQUksQ0FBQ0MsS0FBSyxDQUFDRixDQUFDLEdBQUcsQ0FBRW5DLEdBQUcsR0FBR2lDLElBQUksSUFBS0EsSUFBSSxJQUFJRCxLQUFLLEdBQUdBLEtBQUssR0FBRyxDQUFDLENBQUM7RUFDMUYsTUFBTU0sSUFBSSxHQUFHLENBQUN0QyxHQUFHLEVBQUV1QyxDQUFDLEVBQUVQLEtBQUssS0FBS0ksSUFBSSxDQUFDQyxLQUFLLENBQUNFLENBQUMsSUFBSUgsSUFBSSxDQUFDSSxJQUFJLENBQUMsQ0FBRXhDLEdBQUcsR0FBR2dCLElBQUksSUFBS0EsSUFBSSxJQUFJaUIsSUFBSSxDQUFDLEdBQUdELEtBQUssR0FBR0EsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQzlHLE9BQU87SUFDTEcsQ0FBQyxFQUFFRCxJQUFJLENBQUNsQyxHQUFHLEVBQUUrQixPQUFPLENBQUNJLENBQUMsRUFBRUgsS0FBSyxDQUFDO0lBQzlCTyxDQUFDLEVBQUVELElBQUksQ0FBQ3RDLEdBQUcsRUFBRStCLE9BQU8sQ0FBQ1EsQ0FBQyxFQUFFUCxLQUFLO0VBQy9CLENBQUM7QUFDSCxDQUFDO0FBRUR6RCxPQUFPLENBQUNrRSxpQkFBaUIsR0FBRyxTQUFTQSxpQkFBaUIsQ0FBRTlCLElBQUksRUFBRW9CLE9BQU8sRUFBRUMsS0FBSyxFQUFFO0VBQzVFLE1BQU1VLE9BQU8sR0FBRyxFQUFFO0VBQ2xCLElBQUlDLE9BQU87RUFDWCxLQUFLLElBQUkzQyxHQUFHLElBQUlXLElBQUksRUFBRTtJQUNwQixNQUFNaUMsTUFBTSxHQUFHckUsT0FBTyxDQUFDdUQscUJBQXFCLENBQUM5QixHQUFHLEVBQUUrQixPQUFPLEVBQUVDLEtBQUssQ0FBQztJQUNqRSxJQUFJaEMsR0FBRyxLQUFLVyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7TUFDbkIrQixPQUFPLENBQUNHLElBQUksQ0FBQztRQUFDQyxNQUFNLEVBQUUsT0FBTztRQUFFQyxPQUFPLEVBQUU7VUFBQ0MsT0FBTyxFQUFFLElBQUk7VUFBRWIsQ0FBQyxFQUFFUyxNQUFNLENBQUNULENBQUM7VUFBRUksQ0FBQyxFQUFFSyxNQUFNLENBQUNMO1FBQUM7TUFBQyxDQUFDLENBQUM7TUFDbkZJLE9BQU8sR0FBR0MsTUFBTTtNQUNoQjtJQUNGO0lBQ0EsTUFBTUssTUFBTSxHQUFHO01BQUNkLENBQUMsRUFBRSxDQUFDO01BQUVJLENBQUMsRUFBRTtJQUFDLENBQUM7SUFDM0IsTUFBTVcsS0FBSyxHQUFHTixNQUFNLENBQUNULENBQUMsR0FBR1EsT0FBTyxDQUFDUixDQUFDO0lBQ2xDLElBQUllLEtBQUssR0FBRyxDQUFDLEVBQUU7TUFDYkQsTUFBTSxDQUFDZCxDQUFDLEdBQUdILEtBQUs7TUFDaEIsSUFBSUksSUFBSSxDQUFDZSxHQUFHLENBQUNELEtBQUssQ0FBQyxHQUFHbEIsS0FBSyxFQUFFO1FBQzNCaUIsTUFBTSxDQUFDZCxDQUFDLElBQUlILEtBQUs7TUFDbkI7SUFDRixDQUFDLE1BQU0sSUFBSWtCLEtBQUssR0FBRyxDQUFDLEVBQUU7TUFDcEJELE1BQU0sQ0FBQ2QsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHSCxLQUFLO01BQ3JCLElBQUlJLElBQUksQ0FBQ2UsR0FBRyxDQUFDRCxLQUFLLENBQUMsR0FBR2xCLEtBQUssRUFBRTtRQUMzQmlCLE1BQU0sQ0FBQ2QsQ0FBQyxJQUFJSCxLQUFLO01BQ25CO0lBQ0Y7SUFDQSxNQUFNb0IsS0FBSyxHQUFHUixNQUFNLENBQUNMLENBQUMsR0FBR0ksT0FBTyxDQUFDSixDQUFDO0lBQ2xDLElBQUlhLEtBQUssR0FBRyxDQUFDLEVBQUU7TUFDYkgsTUFBTSxDQUFDVixDQUFDLEdBQUdQLEtBQUs7TUFDaEIsSUFBSUksSUFBSSxDQUFDZSxHQUFHLENBQUNDLEtBQUssQ0FBQyxHQUFHcEIsS0FBSyxFQUFFO1FBQzNCaUIsTUFBTSxDQUFDVixDQUFDLElBQUlQLEtBQUs7TUFDbkI7SUFDRixDQUFDLE1BQU0sSUFBSW9CLEtBQUssR0FBRyxDQUFDLEVBQUU7TUFDcEJILE1BQU0sQ0FBQ1YsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHUCxLQUFLO01BQ3JCLElBQUlJLElBQUksQ0FBQ2UsR0FBRyxDQUFDQyxLQUFLLENBQUMsR0FBR3BCLEtBQUssRUFBRTtRQUMzQmlCLE1BQU0sQ0FBQ1YsQ0FBQyxJQUFJUCxLQUFLO01BQ25CO0lBQ0Y7SUFDQVUsT0FBTyxDQUFDRyxJQUFJLENBQUM7TUFDWEMsTUFBTSxFQUFFLFFBQVE7TUFDaEJDLE9BQU8sRUFBRTtRQUFDQyxPQUFPLEVBQUUsSUFBSTtRQUFFYixDQUFDLEVBQUVjLE1BQU0sQ0FBQ2QsQ0FBQyxHQUFHUSxPQUFPLENBQUNSLENBQUM7UUFBRUksQ0FBQyxFQUFFVSxNQUFNLENBQUNWLENBQUMsR0FBR0ksT0FBTyxDQUFDSjtNQUFDO0lBQzNFLENBQUMsQ0FBQztJQUNGSSxPQUFPLEdBQUdDLE1BQU07RUFDbEI7RUFDQUYsT0FBTyxDQUFDRyxJQUFJLENBQUM7SUFBQ0MsTUFBTSxFQUFFO0VBQVMsQ0FBQyxDQUFDO0VBQ2pDLE9BQU9KLE9BQU87QUFDaEIsQ0FBQztBQUVEbkUsT0FBTyxDQUFDOEUsYUFBYSxHQUFHLGVBQWVBLGFBQWEsQ0FBRWxFLEdBQUcsRUFBRWtCLE1BQU0sRUFBRUMsWUFBWSxFQUFFO0VBQy9FLE1BQU07SUFBRTVCO0VBQVUsQ0FBQyxHQUFHNEIsWUFBWTtFQUNsQ2YsZUFBTSxDQUFDQyxJQUFJLENBQUUseUNBQXdDZCxTQUFVLEVBQUMsQ0FBQztFQUNqRSxNQUFNUyxHQUFHLENBQUNVLGVBQWUsRUFBRTtFQUMzQixNQUFNYyxJQUFJLEdBQUdwQyxPQUFPLENBQUMyQixjQUFjLENBQUN4QixTQUFTLENBQUM7RUFVOUMsTUFBTTRFLFFBQVEsR0FBRyxNQUFNbkUsR0FBRyxDQUFDb0IsV0FBVyxFQUFFO0VBQ3hDLE1BQU1VLEVBQUUsR0FBRyxNQUFNWixNQUFNLENBQUNRLFdBQVcsQ0FBQyxJQUFJLEVBQ3JDLGVBQWN5QyxRQUFRLElBQUksRUFBRSxHQUFHLFVBQVUsR0FBRyxVQUFXLHFCQUFvQixFQUM1RSxLQUFLLENBQ047RUFDRCxNQUFNdkIsT0FBTyxHQUFHLE1BQU0xQixNQUFNLENBQUNrRCxXQUFXLENBQUNuQyxhQUFJLENBQUNDLGFBQWEsQ0FBQ0osRUFBRSxDQUFDLENBQUM7RUFDaEUsTUFBTXVDLElBQUksR0FBRyxNQUFNbkQsTUFBTSxDQUFDb0QsT0FBTyxDQUFDckMsYUFBSSxDQUFDQyxhQUFhLENBQUNKLEVBQUUsQ0FBQyxDQUFDO0VBRXpELE1BQU15QixPQUFPLEdBQUduRSxPQUFPLENBQUNrRSxpQkFBaUIsQ0FBQzlCLElBQUksRUFBRW9CLE9BQU8sRUFBRXlCLElBQUksQ0FBQ0UsS0FBSyxHQUFHLENBQUMsQ0FBQztFQUV4RSxNQUFNckQsTUFBTSxDQUFDc0QsWUFBWSxDQUFDakIsT0FBTyxDQUFDO0VBRWxDLE1BQU0sSUFBQWpDLGVBQUssRUFBQ3JDLGdCQUFnQixDQUFDO0FBQy9CLENBQUM7QUFFREcsT0FBTyxDQUFDVixVQUFVLEdBQUdBLFVBQVU7QUFDL0JVLE9BQU8sQ0FBQ1Qsb0JBQW9CLEdBQUdBLG9CQUFvQjtBQUNuRFMsT0FBTyxDQUFDUixlQUFlLEdBQUdBLGVBQWU7QUFDekNRLE9BQU8sQ0FBQ1AsY0FBYyxHQUFHQSxjQUFjO0FBQ3ZDTyxPQUFPLENBQUNOLGtCQUFrQixHQUFHQSxrQkFBa0I7QUFBQyxlQU1qQ00sT0FBTztBQUFBIn0=