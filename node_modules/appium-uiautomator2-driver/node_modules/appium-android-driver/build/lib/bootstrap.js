"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.COMMAND_TYPES = exports.AndroidBootstrap = void 0;
require("source-map-support/register");
var _uiautomator = _interopRequireDefault(require("./uiautomator"));
var _net = _interopRequireDefault(require("net"));
var _path = _interopRequireDefault(require("path"));
var _lodash = _interopRequireDefault(require("lodash"));
var _driver = require("appium/driver");
var _bluebird = _interopRequireDefault(require("bluebird"));
var _support = require("@appium/support");
const log = _support.logger.getLogger('AndroidBootstrap');
const COMMAND_TYPES = {
  ACTION: 'action',
  SHUTDOWN: 'shutdown'
};
exports.COMMAND_TYPES = COMMAND_TYPES;
const SEND_COMMAND_TIMEOUT = 1 * 60 * 1000;
const getModuleRoot = _lodash.default.memoize(async function getModuleRoot() {
  let currentDir = _path.default.dirname(_path.default.resolve(__filename));
  let isAtFsRoot = false;
  while (!isAtFsRoot) {
    const manifestPath = _path.default.join(currentDir, 'package.json');
    try {
      if ((await _support.fs.exists(manifestPath)) && JSON.parse(await _support.fs.readFile(manifestPath, 'utf8')).name === 'appium-android-driver') {
        return currentDir;
      }
    } catch (ign) {}
    currentDir = _path.default.dirname(currentDir);
    isAtFsRoot = currentDir.length <= _path.default.dirname(currentDir).length;
  }
  throw new Error('Cannot find the root folder of the appium-android-driver Node.js module');
});
class AndroidBootstrap {
  constructor(adb, systemPort = 4724, webSocket = undefined) {
    this.adb = adb;
    this.systemPort = systemPort;
    this.webSocket = webSocket;
    this.ignoreUnexpectedShutdown = false;
  }
  get onUnexpectedShutdown() {
    if (!this._onUnexpectedShutdownPromise) {
      let reject;
      this._onUnexpectedShutdownPromise = new _bluebird.default(function _onUnexpectedShutdownPromise(_resolve, _reject) {
        reject = _reject;
      });
      this._onUnexpectedShutdownPromise.cancel = reject;
    }
    return this._onUnexpectedShutdownPromise;
  }
  async start(appPackage, disableAndroidWatchers = false, acceptSslCerts = false) {
    try {
      const startDetector = s => /Appium Socket Server Ready/.test(s);
      const bootstrapJar = _path.default.resolve(await getModuleRoot(), 'bootstrap', 'bin', 'AppiumBootstrap.jar');
      await this.init();
      await this.adb.forwardPort(this.systemPort, 4724);
      this.process = await this.uiAutomator.start(bootstrapJar, 'io.appium.android.bootstrap.Bootstrap', startDetector, '-e', 'pkg', appPackage, '-e', 'disableAndroidWatchers', disableAndroidWatchers, '-e', 'acceptSslCerts', acceptSslCerts);
      this.process.on('output', (stdout, stderr) => {
        const alertRe = /Emitting system alert message/;
        if (alertRe.test(stdout)) {
          log.debug('Emitting alert message...');
          if (this.webSocket) {
            this.webSocket.sockets.emit('alert', {
              message: stdout
            });
          }
        }
        let stdoutLines = (stdout || '').split('\n');
        const uiautoLog = /\[APPIUM-UIAUTO\](.+)\[\/APPIUM-UIAUTO\]/;
        for (let line of stdoutLines) {
          if (line.trim()) {
            if (uiautoLog.test(line)) {
              let innerLine = uiautoLog.exec(line)[1].trim();
              let logMethod = log.info.bind(log);
              if (/\[debug\]/.test(innerLine)) {
                logMethod = log.debug.bind(log);
              }
              logMethod(`[BOOTSTRAP LOG] ${innerLine}`);
            } else {
              log.debug(`[UIAUTO STDOUT] ${line}`);
            }
          }
        }
        let stderrLines = (stderr || '').split('\n');
        for (let line of stderrLines) {
          if (line.trim()) {
            log.debug(`[UIAUTO STDERR] ${line}`);
          }
        }
      });
      return await new _bluebird.default((resolve, reject) => {
        try {
          this.socketClient = _net.default.connect(this.systemPort, '127.0.0.1');
          this.socketClient.on('error', err => {
            if (!this.ignoreUnexpectedShutdown) {
              throw new Error(`Android bootstrap socket crashed: ${err}`);
            }
          });
          this.socketClient.once('connect', () => {
            log.info('Android bootstrap socket is now connected');
            resolve();
          });
        } catch (err) {
          reject(err);
        }
      });
    } catch (err) {
      log.errorAndThrow(`Error occured while starting AndroidBootstrap. Original error: ${err}`);
    }
  }
  async sendCommand(type, extra = {}) {
    if (!this.socketClient) {
      throw new Error('Socket connection closed unexpectedly');
    }
    return await new _bluebird.default((resolve, reject) => {
      let cmd = Object.assign({
        cmd: type
      }, extra);
      let cmdJson = `${JSON.stringify(cmd)} \n`;
      log.debug(`Sending command to android: ${_lodash.default.truncate(cmdJson, {
        length: 1000
      }).trim()}`);
      this.socketClient.write(cmdJson);
      this.socketClient.setEncoding('utf8');
      let streamData = '';
      let sendCommandTimeoutHandler = null;
      this.socketClient.on('data', data => {
        if (sendCommandTimeoutHandler) {
          clearTimeout(sendCommandTimeoutHandler);
        }
        log.debug('Received command result from bootstrap');
        try {
          streamData = JSON.parse(streamData + data);
          this.socketClient.removeAllListeners('data');
          if (streamData.status === 0) {
            return resolve(streamData.value);
          }
          reject((0, _driver.errorFromCode)(streamData.status, streamData.value));
        } catch (err) {
          if (!_lodash.default.isString(streamData)) {
            log.error('Got an unexpected error inside socket listener');
            log.error(err.stack);
            return reject((0, _driver.errorFromCode)(13, err.message));
          }
          log.debug(`Stream still not complete, waiting up to ${SEND_COMMAND_TIMEOUT}ms for the data to arrive`);
          streamData += data;
          sendCommandTimeoutHandler = setTimeout(() => {
            const errMsg = `Server socket stopped responding. The recent response was '${streamData}'`;
            log.error(errMsg);
            this.socketClient.removeAllListeners('data');
            reject((0, _driver.errorFromCode)(13, errMsg));
          }, SEND_COMMAND_TIMEOUT);
        }
      });
    });
  }
  async sendAction(action, params = {}) {
    let extra = {
      action,
      params
    };
    return await this.sendCommand(COMMAND_TYPES.ACTION, extra);
  }
  async shutdown() {
    if (!this.uiAutomator) {
      log.warn('Cannot shut down Android bootstrap; it has already shut down');
      return;
    }
    this.uiAutomator.removeAllListeners(_uiautomator.default.EVENT_CHANGED);
    if (this.socketClient) {
      await this.sendCommand(COMMAND_TYPES.SHUTDOWN);
    }
    await this.uiAutomator.shutdown();
    this.uiAutomator = null;
  }
  async init() {
    this.uiAutomator = new _uiautomator.default(this.adb);
    this.uiAutomator.on(_uiautomator.default.EVENT_CHANGED, msg => {
      if (msg.state === _uiautomator.default.STATE_STOPPED) {
        this.uiAutomator = null;
        this.onUnexpectedShutdown.cancel(new Error('UiAUtomator shut down unexpectedly'));
      }
    });
  }
  set ignoreUnexpectedShutdown(ignore) {
    log.debug(`${ignore ? 'Ignoring' : 'Watching for'} bootstrap disconnect`);
    this._ignoreUnexpectedShutdown = ignore;
  }
  get ignoreUnexpectedShutdown() {
    return this._ignoreUnexpectedShutdown;
  }
}
exports.AndroidBootstrap = AndroidBootstrap;
var _default = AndroidBootstrap;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJDT01NQU5EX1RZUEVTIiwiQUNUSU9OIiwiU0hVVERPV04iLCJTRU5EX0NPTU1BTkRfVElNRU9VVCIsImdldE1vZHVsZVJvb3QiLCJfIiwibWVtb2l6ZSIsImN1cnJlbnREaXIiLCJwYXRoIiwiZGlybmFtZSIsInJlc29sdmUiLCJfX2ZpbGVuYW1lIiwiaXNBdEZzUm9vdCIsIm1hbmlmZXN0UGF0aCIsImpvaW4iLCJmcyIsImV4aXN0cyIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlIiwibmFtZSIsImlnbiIsImxlbmd0aCIsIkVycm9yIiwiQW5kcm9pZEJvb3RzdHJhcCIsImNvbnN0cnVjdG9yIiwiYWRiIiwic3lzdGVtUG9ydCIsIndlYlNvY2tldCIsInVuZGVmaW5lZCIsImlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biIsIm9uVW5leHBlY3RlZFNodXRkb3duIiwiX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSIsInJlamVjdCIsIkIiLCJfcmVzb2x2ZSIsIl9yZWplY3QiLCJjYW5jZWwiLCJzdGFydCIsImFwcFBhY2thZ2UiLCJkaXNhYmxlQW5kcm9pZFdhdGNoZXJzIiwiYWNjZXB0U3NsQ2VydHMiLCJzdGFydERldGVjdG9yIiwicyIsInRlc3QiLCJib290c3RyYXBKYXIiLCJpbml0IiwiZm9yd2FyZFBvcnQiLCJwcm9jZXNzIiwidWlBdXRvbWF0b3IiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsImFsZXJ0UmUiLCJkZWJ1ZyIsInNvY2tldHMiLCJlbWl0IiwibWVzc2FnZSIsInN0ZG91dExpbmVzIiwic3BsaXQiLCJ1aWF1dG9Mb2ciLCJsaW5lIiwidHJpbSIsImlubmVyTGluZSIsImV4ZWMiLCJsb2dNZXRob2QiLCJpbmZvIiwiYmluZCIsInN0ZGVyckxpbmVzIiwic29ja2V0Q2xpZW50IiwibmV0IiwiY29ubmVjdCIsImVyciIsIm9uY2UiLCJlcnJvckFuZFRocm93Iiwic2VuZENvbW1hbmQiLCJ0eXBlIiwiZXh0cmEiLCJjbWQiLCJPYmplY3QiLCJhc3NpZ24iLCJjbWRKc29uIiwic3RyaW5naWZ5IiwidHJ1bmNhdGUiLCJ3cml0ZSIsInNldEVuY29kaW5nIiwic3RyZWFtRGF0YSIsInNlbmRDb21tYW5kVGltZW91dEhhbmRsZXIiLCJkYXRhIiwiY2xlYXJUaW1lb3V0IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwic3RhdHVzIiwidmFsdWUiLCJlcnJvckZyb21Db2RlIiwiaXNTdHJpbmciLCJlcnJvciIsInN0YWNrIiwic2V0VGltZW91dCIsImVyck1zZyIsInNlbmRBY3Rpb24iLCJhY3Rpb24iLCJwYXJhbXMiLCJzaHV0ZG93biIsIndhcm4iLCJVaUF1dG9tYXRvciIsIkVWRU5UX0NIQU5HRUQiLCJtc2ciLCJzdGF0ZSIsIlNUQVRFX1NUT1BQRUQiLCJpZ25vcmUiLCJfaWdub3JlVW5leHBlY3RlZFNodXRkb3duIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL2Jvb3RzdHJhcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVWlBdXRvbWF0b3IgZnJvbSAnLi91aWF1dG9tYXRvcic7XG5pbXBvcnQgbmV0IGZyb20gJ25ldCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBlcnJvckZyb21Db2RlIH0gZnJvbSAnYXBwaXVtL2RyaXZlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBsb2dnZXIsIGZzIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdBbmRyb2lkQm9vdHN0cmFwJyk7XG5jb25zdCBDT01NQU5EX1RZUEVTID0ge1xuICBBQ1RJT046ICdhY3Rpb24nLFxuICBTSFVURE9XTjogJ3NodXRkb3duJ1xufTtcbmNvbnN0IFNFTkRfQ09NTUFORF9USU1FT1VUID0gMSAqIDYwICogMTAwMDtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBwYXRoIHRvIHRoZSBjdXJyZW50IG1vZHVsZSdzIHJvb3QgZm9sZGVyXG4gKlxuICogQHJldHVybnMge3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byBtb2R1bGUgcm9vdFxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBjdXJyZW50IG1vZHVsZSByb290IGZvbGRlciBjYW5ub3QgYmUgZGV0ZXJtaW5lZFxuICovXG5jb25zdCBnZXRNb2R1bGVSb290ID0gXy5tZW1vaXplKGFzeW5jIGZ1bmN0aW9uIGdldE1vZHVsZVJvb3QgKCkge1xuICBsZXQgY3VycmVudERpciA9IHBhdGguZGlybmFtZShwYXRoLnJlc29sdmUoX19maWxlbmFtZSkpO1xuICBsZXQgaXNBdEZzUm9vdCA9IGZhbHNlO1xuICB3aGlsZSAoIWlzQXRGc1Jvb3QpIHtcbiAgICBjb25zdCBtYW5pZmVzdFBhdGggPSBwYXRoLmpvaW4oY3VycmVudERpciwgJ3BhY2thZ2UuanNvbicpO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKG1hbmlmZXN0UGF0aCkgJiZcbiAgICAgICAgICBKU09OLnBhcnNlKGF3YWl0IGZzLnJlYWRGaWxlKG1hbmlmZXN0UGF0aCwgJ3V0ZjgnKSkubmFtZSA9PT0gJ2FwcGl1bS1hbmRyb2lkLWRyaXZlcicpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnREaXI7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIGN1cnJlbnREaXIgPSBwYXRoLmRpcm5hbWUoY3VycmVudERpcik7XG4gICAgaXNBdEZzUm9vdCA9IGN1cnJlbnREaXIubGVuZ3RoIDw9IHBhdGguZGlybmFtZShjdXJyZW50RGlyKS5sZW5ndGg7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZmluZCB0aGUgcm9vdCBmb2xkZXIgb2YgdGhlIGFwcGl1bS1hbmRyb2lkLWRyaXZlciBOb2RlLmpzIG1vZHVsZScpO1xufSk7XG5cbmNsYXNzIEFuZHJvaWRCb290c3RyYXAge1xuICBjb25zdHJ1Y3RvciAoYWRiLCBzeXN0ZW1Qb3J0ID0gNDcyNCwgd2ViU29ja2V0ID0gdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5hZGIgPSBhZGI7XG4gICAgdGhpcy5zeXN0ZW1Qb3J0ID0gc3lzdGVtUG9ydDtcbiAgICB0aGlzLndlYlNvY2tldCA9IHdlYlNvY2tldDtcbiAgICB0aGlzLmlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0IG9uVW5leHBlY3RlZFNodXRkb3duICgpIHtcbiAgICBpZiAoIXRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSkge1xuICAgICAgbGV0IHJlamVjdDtcbiAgICAgIHRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZSA9IG5ldyBCKGZ1bmN0aW9uIF9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2UgKF9yZXNvbHZlLCBfcmVqZWN0KSB7XG4gICAgICAgIHJlamVjdCA9IF9yZWplY3Q7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX29uVW5leHBlY3RlZFNodXRkb3duUHJvbWlzZS5jYW5jZWwgPSByZWplY3Q7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9vblVuZXhwZWN0ZWRTaHV0ZG93blByb21pc2U7XG4gIH1cblxuICBhc3luYyBzdGFydCAoYXBwUGFja2FnZSwgZGlzYWJsZUFuZHJvaWRXYXRjaGVycyA9IGZhbHNlLCBhY2NlcHRTc2xDZXJ0cyA9IGZhbHNlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXJ0RGV0ZWN0b3IgPSAocykgPT4gL0FwcGl1bSBTb2NrZXQgU2VydmVyIFJlYWR5Ly50ZXN0KHMpO1xuICAgICAgY29uc3QgYm9vdHN0cmFwSmFyID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldE1vZHVsZVJvb3QoKSwgJ2Jvb3RzdHJhcCcsICdiaW4nLCAnQXBwaXVtQm9vdHN0cmFwLmphcicpO1xuXG4gICAgICBhd2FpdCB0aGlzLmluaXQoKTtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLmZvcndhcmRQb3J0KHRoaXMuc3lzdGVtUG9ydCwgNDcyNCk7XG4gICAgICB0aGlzLnByb2Nlc3MgPSBhd2FpdCB0aGlzLnVpQXV0b21hdG9yLnN0YXJ0KFxuICAgICAgICBib290c3RyYXBKYXIsICdpby5hcHBpdW0uYW5kcm9pZC5ib290c3RyYXAuQm9vdHN0cmFwJyxcbiAgICAgICAgc3RhcnREZXRlY3RvcixcbiAgICAgICAgJy1lJywgJ3BrZycsIGFwcFBhY2thZ2UsXG4gICAgICAgICctZScsICdkaXNhYmxlQW5kcm9pZFdhdGNoZXJzJywgZGlzYWJsZUFuZHJvaWRXYXRjaGVycyxcbiAgICAgICAgJy1lJywgJ2FjY2VwdFNzbENlcnRzJywgYWNjZXB0U3NsQ2VydHNcbiAgICAgICk7XG5cbiAgICAgIC8vIHByb2Nlc3MgdGhlIG91dHB1dFxuICAgICAgdGhpcy5wcm9jZXNzLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgICAgY29uc3QgYWxlcnRSZSA9IC9FbWl0dGluZyBzeXN0ZW0gYWxlcnQgbWVzc2FnZS87XG4gICAgICAgIGlmIChhbGVydFJlLnRlc3Qoc3Rkb3V0KSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZygnRW1pdHRpbmcgYWxlcnQgbWVzc2FnZS4uLicpO1xuICAgICAgICAgIGlmICh0aGlzLndlYlNvY2tldCkge1xuICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuc29ja2V0cy5lbWl0KCdhbGVydCcsIHttZXNzYWdlOiBzdGRvdXR9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0aGUgYm9vdHN0cmFwIGxvZ2dlciB3cmFwcyBpdHMgb3duIGxvZyBsaW5lcyB3aXRoXG4gICAgICAgIC8vIFtBUFBJVU0tVUlBVVRPXSAuLi4gW0FQUElVTS1VSUFVVE9dXG4gICAgICAgIC8vIGFuZCBsZWF2ZXMgYWN0dWFsIFVpQXV0b21hdG9yIGxvZ3MgYXMgdGhleSBhcmVcbiAgICAgICAgbGV0IHN0ZG91dExpbmVzID0gKHN0ZG91dCB8fCAnJykuc3BsaXQoJ1xcbicpO1xuICAgICAgICBjb25zdCB1aWF1dG9Mb2cgPSAvXFxbQVBQSVVNLVVJQVVUT1xcXSguKylcXFtcXC9BUFBJVU0tVUlBVVRPXFxdLztcbiAgICAgICAgZm9yIChsZXQgbGluZSBvZiBzdGRvdXRMaW5lcykge1xuICAgICAgICAgIGlmIChsaW5lLnRyaW0oKSkge1xuICAgICAgICAgICAgaWYgKHVpYXV0b0xvZy50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICAgIGxldCBpbm5lckxpbmUgPSB1aWF1dG9Mb2cuZXhlYyhsaW5lKVsxXS50cmltKCk7XG4gICAgICAgICAgICAgIGxldCBsb2dNZXRob2QgPSBsb2cuaW5mby5iaW5kKGxvZyk7XG4gICAgICAgICAgICAgIC8vIGlmIHRoZSBib290c3RyYXAgbG9nIGNvbnNpZGVycyBzb21ldGhpbmcgZGVidWcsIGxvZyB0aGF0IGFzXG4gICAgICAgICAgICAgIC8vIGRlYnVnIGFuZCBub3QgaW5mb1xuICAgICAgICAgICAgICBpZiAoL1xcW2RlYnVnXFxdLy50ZXN0KGlubmVyTGluZSkpIHtcbiAgICAgICAgICAgICAgICBsb2dNZXRob2QgPSBsb2cuZGVidWcuYmluZChsb2cpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGxvZ01ldGhvZChgW0JPT1RTVFJBUCBMT0ddICR7aW5uZXJMaW5lfWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nLmRlYnVnKGBbVUlBVVRPIFNURE9VVF0gJHtsaW5lfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBzdGRlcnJMaW5lcyA9IChzdGRlcnIgfHwgJycpLnNwbGl0KCdcXG4nKTtcbiAgICAgICAgZm9yIChsZXQgbGluZSBvZiBzdGRlcnJMaW5lcykge1xuICAgICAgICAgIGlmIChsaW5lLnRyaW0oKSkge1xuICAgICAgICAgICAgbG9nLmRlYnVnKGBbVUlBVVRPIFNUREVSUl0gJHtsaW5lfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIG9ubHkgcmV0dXJuIHdoZW4gdGhlIHNvY2tldCBjbGllbnQgaGFzIGNvbm5lY3RlZFxuICAgICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLnNvY2tldENsaWVudCA9IG5ldC5jb25uZWN0KHRoaXMuc3lzdGVtUG9ydCwgJzEyNy4wLjAuMScpO1xuICAgICAgICAgIC8vIFdpbmRvd3M6IHRoZSBzb2NrZXQgZXJyb3JzIG91dCB3aGVuIEFEQiByZXN0YXJ0cy4gTGV0J3MgY2F0Y2ggaXQgdG8gYXZvaWQgY3Jhc2hpbmcuXG4gICAgICAgICAgdGhpcy5zb2NrZXRDbGllbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93bikge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFuZHJvaWQgYm9vdHN0cmFwIHNvY2tldCBjcmFzaGVkOiAke2Vycn1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLnNvY2tldENsaWVudC5vbmNlKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICAgICAgbG9nLmluZm8oJ0FuZHJvaWQgYm9vdHN0cmFwIHNvY2tldCBpcyBub3cgY29ubmVjdGVkJyk7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBFcnJvciBvY2N1cmVkIHdoaWxlIHN0YXJ0aW5nIEFuZHJvaWRCb290c3RyYXAuIE9yaWdpbmFsIGVycm9yOiAke2Vycn1gKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZW5kQ29tbWFuZCAodHlwZSwgZXh0cmEgPSB7fSkge1xuICAgIGlmICghdGhpcy5zb2NrZXRDbGllbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU29ja2V0IGNvbm5lY3Rpb24gY2xvc2VkIHVuZXhwZWN0ZWRseScpO1xuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgY21kID0gT2JqZWN0LmFzc2lnbih7Y21kOiB0eXBlfSwgZXh0cmEpO1xuICAgICAgbGV0IGNtZEpzb24gPSBgJHtKU09OLnN0cmluZ2lmeShjbWQpfSBcXG5gO1xuICAgICAgbG9nLmRlYnVnKGBTZW5kaW5nIGNvbW1hbmQgdG8gYW5kcm9pZDogJHtfLnRydW5jYXRlKGNtZEpzb24sIHtsZW5ndGg6IDEwMDB9KS50cmltKCl9YCk7XG4gICAgICB0aGlzLnNvY2tldENsaWVudC53cml0ZShjbWRKc29uKTtcbiAgICAgIHRoaXMuc29ja2V0Q2xpZW50LnNldEVuY29kaW5nKCd1dGY4Jyk7XG4gICAgICBsZXQgc3RyZWFtRGF0YSA9ICcnO1xuICAgICAgbGV0IHNlbmRDb21tYW5kVGltZW91dEhhbmRsZXIgPSBudWxsO1xuICAgICAgdGhpcy5zb2NrZXRDbGllbnQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoc2VuZENvbW1hbmRUaW1lb3V0SGFuZGxlcikge1xuICAgICAgICAgIGNsZWFyVGltZW91dChzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyKTtcbiAgICAgICAgfVxuICAgICAgICBsb2cuZGVidWcoJ1JlY2VpdmVkIGNvbW1hbmQgcmVzdWx0IGZyb20gYm9vdHN0cmFwJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgc3RyZWFtRGF0YSA9IEpTT04ucGFyc2Uoc3RyZWFtRGF0YSArIGRhdGEpO1xuICAgICAgICAgIC8vIHdlIHN1Y2Nlc3NmdWxseSBwYXJzZWQgSlNPTiBzbyB3ZSd2ZSBnb3QgYWxsIHRoZSBkYXRhLFxuICAgICAgICAgIC8vIHJlbW92ZSB0aGUgc29ja2V0IGxpc3RlbmVyIGFuZCBldmFsdWF0ZVxuICAgICAgICAgIHRoaXMuc29ja2V0Q2xpZW50LnJlbW92ZUFsbExpc3RlbmVycygnZGF0YScpO1xuICAgICAgICAgIGlmIChzdHJlYW1EYXRhLnN0YXR1cyA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoc3RyZWFtRGF0YS52YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlamVjdChlcnJvckZyb21Db2RlKHN0cmVhbURhdGEuc3RhdHVzLCBzdHJlYW1EYXRhLnZhbHVlKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGlmICghXy5pc1N0cmluZyhzdHJlYW1EYXRhKSkge1xuICAgICAgICAgICAgbG9nLmVycm9yKCdHb3QgYW4gdW5leHBlY3RlZCBlcnJvciBpbnNpZGUgc29ja2V0IGxpc3RlbmVyJyk7XG4gICAgICAgICAgICBsb2cuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3JGcm9tQ29kZSgxMywgZXJyLm1lc3NhZ2UpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbG9nLmRlYnVnKGBTdHJlYW0gc3RpbGwgbm90IGNvbXBsZXRlLCB3YWl0aW5nIHVwIHRvICR7U0VORF9DT01NQU5EX1RJTUVPVVR9bXMgZm9yIHRoZSBkYXRhIHRvIGFycml2ZWApO1xuICAgICAgICAgIHN0cmVhbURhdGEgKz0gZGF0YTtcbiAgICAgICAgICBzZW5kQ29tbWFuZFRpbWVvdXRIYW5kbGVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJNc2cgPSBgU2VydmVyIHNvY2tldCBzdG9wcGVkIHJlc3BvbmRpbmcuIFRoZSByZWNlbnQgcmVzcG9uc2Ugd2FzICcke3N0cmVhbURhdGF9J2A7XG4gICAgICAgICAgICBsb2cuZXJyb3IoZXJyTXNnKTtcbiAgICAgICAgICAgIHRoaXMuc29ja2V0Q2xpZW50LnJlbW92ZUFsbExpc3RlbmVycygnZGF0YScpO1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yRnJvbUNvZGUoMTMsIGVyck1zZykpO1xuICAgICAgICAgIH0sIFNFTkRfQ09NTUFORF9USU1FT1VUKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBzZW5kQWN0aW9uIChhY3Rpb24sIHBhcmFtcyA9IHt9KSB7XG4gICAgbGV0IGV4dHJhID0ge2FjdGlvbiwgcGFyYW1zfTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kQ29tbWFuZChDT01NQU5EX1RZUEVTLkFDVElPTiwgZXh0cmEpO1xuICB9XG5cbiAgYXN5bmMgc2h1dGRvd24gKCkge1xuICAgIGlmICghdGhpcy51aUF1dG9tYXRvcikge1xuICAgICAgbG9nLndhcm4oJ0Nhbm5vdCBzaHV0IGRvd24gQW5kcm9pZCBib290c3RyYXA7IGl0IGhhcyBhbHJlYWR5IHNodXQgZG93bicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHJlbW92ZSBsaXN0bmVycyBzbyB3ZSBkb24ndCB0cmlnZ2VyIHVuZXhwZWN0ZWQgc2h1dGRvd25cbiAgICB0aGlzLnVpQXV0b21hdG9yLnJlbW92ZUFsbExpc3RlbmVycyhVaUF1dG9tYXRvci5FVkVOVF9DSEFOR0VEKTtcbiAgICBpZiAodGhpcy5zb2NrZXRDbGllbnQpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZENvbW1hbmQoQ09NTUFORF9UWVBFUy5TSFVURE9XTik7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMudWlBdXRvbWF0b3Iuc2h1dGRvd24oKTtcbiAgICB0aGlzLnVpQXV0b21hdG9yID0gbnVsbDtcbiAgfVxuXG4gIC8vIHRoaXMgaGVscGVyIGZ1bmN0aW9uIG1ha2VzIHVuaXQgdGVzdGluZyBlYXNpZXIuXG4gIGFzeW5jIGluaXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aGlzLnVpQXV0b21hdG9yID0gbmV3IFVpQXV0b21hdG9yKHRoaXMuYWRiKTtcblxuICAgIC8vIEhhbmRsZSB1bmV4cGVjdGVkIFVpQXV0b21hdG9yIHNodXRkb3duXG4gICAgdGhpcy51aUF1dG9tYXRvci5vbihVaUF1dG9tYXRvci5FVkVOVF9DSEFOR0VELCAobXNnKSA9PiB7XG4gICAgICBpZiAobXNnLnN0YXRlID09PSBVaUF1dG9tYXRvci5TVEFURV9TVE9QUEVEKSB7XG4gICAgICAgIHRoaXMudWlBdXRvbWF0b3IgPSBudWxsO1xuICAgICAgICB0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duLmNhbmNlbChuZXcgRXJyb3IoJ1VpQVV0b21hdG9yIHNodXQgZG93biB1bmV4cGVjdGVkbHknKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXQgaWdub3JlVW5leHBlY3RlZFNodXRkb3duIChpZ25vcmUpIHtcbiAgICBsb2cuZGVidWcoYCR7aWdub3JlID8gJ0lnbm9yaW5nJyA6ICdXYXRjaGluZyBmb3InfSBib290c3RyYXAgZGlzY29ubmVjdGApO1xuICAgIHRoaXMuX2lnbm9yZVVuZXhwZWN0ZWRTaHV0ZG93biA9IGlnbm9yZTtcbiAgfVxuXG4gIGdldCBpZ25vcmVVbmV4cGVjdGVkU2h1dGRvd24gKCkge1xuICAgIHJldHVybiB0aGlzLl9pZ25vcmVVbmV4cGVjdGVkU2h1dGRvd247XG4gIH1cbn1cblxuZXhwb3J0IHsgQW5kcm9pZEJvb3RzdHJhcCwgQ09NTUFORF9UWVBFUyB9O1xuZXhwb3J0IGRlZmF1bHQgQW5kcm9pZEJvb3RzdHJhcDtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBLE1BQU1BLEdBQUcsR0FBR0MsZUFBTSxDQUFDQyxTQUFTLENBQUMsa0JBQWtCLENBQUM7QUFDaEQsTUFBTUMsYUFBYSxHQUFHO0VBQ3BCQyxNQUFNLEVBQUUsUUFBUTtFQUNoQkMsUUFBUSxFQUFFO0FBQ1osQ0FBQztBQUFDO0FBQ0YsTUFBTUMsb0JBQW9CLEdBQUcs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