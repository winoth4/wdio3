{"version":3,"file":"install.js","names":["DOWNLOAD_TIMEOUT_MS","LATEST_VERSION","formatCdVersion","ver","retrieveData","CD_CDN","accept","timeout","trim","prepareChromedriverDir","platformName","chromedriverDir","getChromedriverDir","fs","exists","mkdirp","install","osInfo","getOsInfo","client","ChromedriverStorageClient","name","syncDrivers","versions","CD_VER","doInstall"],"sources":["../../lib/install.js"],"sourcesContent":["import { fs, mkdirp } from '@appium/support';\nimport ChromedriverStorageClient from './storage-client';\nimport {\n  CD_CDN, CD_VER, retrieveData, getOsInfo, getChromedriverDir,\n} from './utils';\n\n\nconst DOWNLOAD_TIMEOUT_MS = 15 * 1000;\nconst LATEST_VERSION = 'LATEST';\n\nasync function formatCdVersion (ver) {\n  return ver === LATEST_VERSION\n    ? (await retrieveData(`${CD_CDN}/LATEST_RELEASE`, {\n      'user-agent': 'appium',\n      accept: '*/*',\n    }, { timeout: DOWNLOAD_TIMEOUT_MS })).trim()\n    : ver;\n}\n\nasync function prepareChromedriverDir (platformName) {\n  const chromedriverDir = getChromedriverDir(platformName);\n  if (!await fs.exists(chromedriverDir)) {\n    await mkdirp(chromedriverDir);\n  }\n  return chromedriverDir;\n}\n\nasync function install () {\n  const osInfo = await getOsInfo();\n  const client = new ChromedriverStorageClient({\n    chromedriverDir: await prepareChromedriverDir(osInfo.name),\n  });\n  await client.syncDrivers({\n    osInfo,\n    versions: [await formatCdVersion(CD_VER)],\n  });\n}\n\nasync function doInstall () {\n  await install();\n}\n\nexport { install, doInstall };\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AAKA,MAAMA,mBAAmB,GAAG,EAAE,GAAG,IAAI;AACrC,MAAMC,cAAc,GAAG,QAAQ;AAE/B,eAAeC,eAAe,CAAEC,GAAG,EAAE;EACnC,OAAOA,GAAG,KAAKF,cAAc,GACzB,CAAC,MAAM,IAAAG,mBAAY,EAAE,GAAEC,aAAO,iBAAgB,EAAE;IAChD,YAAY,EAAE,QAAQ;IACtBC,MAAM,EAAE;EACV,CAAC,EAAE;IAAEC,OAAO,EAAEP;EAAoB,CAAC,CAAC,EAAEQ,IAAI,EAAE,GAC1CL,GAAG;AACT;AAEA,eAAeM,sBAAsB,CAAEC,YAAY,EAAE;EACnD,MAAMC,eAAe,GAAG,IAAAC,yBAAkB,EAACF,YAAY,CAAC;EACxD,IAAI,EAAC,MAAMG,WAAE,CAACC,MAAM,CAACH,eAAe,CAAC,GAAE;IACrC,MAAM,IAAAI,eAAM,EAACJ,eAAe,CAAC;EAC/B;EACA,OAAOA,eAAe;AACxB;AAEA,eAAeK,OAAO,GAAI;EACxB,MAAMC,MAAM,GAAG,MAAM,IAAAC,gBAAS,GAAE;EAChC,MAAMC,MAAM,GAAG,IAAIC,sBAAyB,CAAC;IAC3CT,eAAe,EAAE,MAAMF,sBAAsB,CAACQ,MAAM,CAACI,IAAI;EAC3D,CAAC,CAAC;EACF,MAAMF,MAAM,CAACG,WAAW,CAAC;IACvBL,MAAM;IACNM,QAAQ,EAAE,CAAC,MAAMrB,eAAe,CAACsB,aAAM,CAAC;EAC1C,CAAC,CAAC;AACJ;AAEA,eAAeC,SAAS,GAAI;EAC1B,MAAMT,OAAO,EAAE;AACjB"}