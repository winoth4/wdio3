{"version":3,"file":"helpers.js","names":["helpers","ensureInternetPermissionForApp","adb","app","has","hasInternetPermissionFromManifest","msg","Error","isWriteable","filePath","fs","access","W_OK","system","isWindows","close","open","ign","signApp","appPath","path","dirname","sign"],"sources":["../../lib/helpers.js"],"sourcesContent":["import path from 'path';\nimport { fs, system } from 'appium/support';\n\n\nlet helpers = {};\n\nhelpers.ensureInternetPermissionForApp = async function (adb, app) {\n  let has = await adb.hasInternetPermissionFromManifest(app);\n  if (has) {\n    return;\n  }\n  let msg = 'Your apk does not have INTERNET permissions. Uiautomator2 needs ' +\n            'the internet permission to proceed. Please check if you have ' +\n            '<uses-permission android:name=\"android.**permission.INTERNET\"/>' +\n            'in your AndroidManifest.xml';\n  throw new Error(msg);\n};\n\nhelpers.isWriteable = async function isWriteable (filePath) {\n  try {\n    await fs.access(filePath, fs.W_OK);\n    if (system.isWindows()) {\n      // On operating systems, where access-control policies may\n      // limit access to the file system, `fs.access` does not work\n      // as expected. See https://groups.google.com/forum/#!topic/nodejs/qmZtIwDRSYo\n      // for more details\n      await fs.close(await fs.open(filePath, 'r+'));\n    }\n    return true;\n  } catch (ign) {\n    return false;\n  }\n};\n\nhelpers.signApp = async function (adb, appPath) {\n  if (!await this.isWriteable(appPath)) {\n    throw new Error(`The application at '${appPath}' is not writeable. ` +\n      `Please grant write permissions to this file or to its parent folder '${path.dirname(appPath)}' ` +\n      `for the Appium process, so it could sign the application`);\n  }\n  await adb.sign(appPath);\n};\n\nexport default helpers;\n"],"mappings":";;;;;;;;AAAA;AACA;AAGA,IAAIA,OAAO,GAAG,CAAC,CAAC;AAEhBA,OAAO,CAACC,8BAA8B,GAAG,gBAAgBC,GAAG,EAAEC,GAAG,EAAE;EACjE,IAAIC,GAAG,GAAG,MAAMF,GAAG,CAACG,iCAAiC,CAACF,GAAG,CAAC;EAC1D,IAAIC,GAAG,EAAE;IACP;EACF;EACA,IAAIE,GAAG,GAAG,kEAAkE,GAClE,+DAA+D,GAC/D,iEAAiE,GACjE,6BAA6B;EACvC,MAAM,IAAIC,KAAK,CAACD,GAAG,CAAC;AACtB,CAAC;AAEDN,OAAO,CAACQ,WAAW,GAAG,eAAeA,WAAW,CAAEC,QAAQ,EAAE;EAC1D,IAAI;IACF,MAAMC,WAAE,CAACC,MAAM,CAACF,QAAQ,EAAEC,WAAE,CAACE,IAAI,CAAC;IAClC,IAAIC,eAAM,CAACC,SAAS,EAAE,EAAE;MAKtB,MAAMJ,WAAE,CAACK,KAAK,CAAC,MAAML,WAAE,CAACM,IAAI,CAACP,QAAQ,EAAE,IAAI,CAAC,CAAC;IAC/C;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOQ,GAAG,EAAE;IACZ,OAAO,KAAK;EACd;AACF,CAAC;AAEDjB,OAAO,CAACkB,OAAO,GAAG,gBAAgBhB,GAAG,EAAEiB,OAAO,EAAE;EAC9C,IAAI,EAAC,MAAM,IAAI,CAACX,WAAW,CAACW,OAAO,CAAC,GAAE;IACpC,MAAM,IAAIZ,KAAK,CAAE,uBAAsBY,OAAQ,sBAAqB,GACjE,wEAAuEC,aAAI,CAACC,OAAO,CAACF,OAAO,CAAE,IAAG,GAChG,0DAAyD,CAAC;EAC/D;EACA,MAAMjB,GAAG,CAACoB,IAAI,CAACH,OAAO,CAAC;AACzB,CAAC;AAAC,eAEanB,OAAO;AAAA"}