"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.helpers = exports.default = void 0;
require("source-map-support/register");
var _cssConverter = _interopRequireDefault(require("../css-converter"));
const helpers = {};
exports.helpers = helpers;
const MAGIC_FIRST_VIS_CHILD_SEL = /\/\*\[@firstVisible ?= ?('|")true\1\]/;
const MAGIC_SCROLLABLE_SEL = /\/\/\*\[@scrollable ?= ?('|")true\1\]/;
const MAGIC_SCROLLABLE_BY = 'new UiSelector().scrollable(true)';
helpers.doFindElementOrEls = async function (params) {
  if (params.strategy === 'xpath' && MAGIC_FIRST_VIS_CHILD_SEL.test(params.selector)) {
    let elementId = params.context;
    return await this.uiautomator2.jwproxy.command(`/appium/element/${elementId}/first_visible`, 'GET', {});
  }
  if (params.strategy === 'xpath' && MAGIC_SCROLLABLE_SEL.test(params.selector)) {
    params.strategy = '-android uiautomator';
    params.selector = MAGIC_SCROLLABLE_BY;
  }
  if (params.strategy === 'css selector') {
    params.strategy = '-android uiautomator';
    params.selector = new _cssConverter.default(params.selector, this.opts.appPackage).toUiAutomatorSelector();
  }
  return await this.uiautomator2.jwproxy.command(`/element${params.multiple ? 's' : ''}`, 'POST', params);
};
var _default = helpers;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWxwZXJzIiwiTUFHSUNfRklSU1RfVklTX0NISUxEX1NFTCIsIk1BR0lDX1NDUk9MTEFCTEVfU0VMIiwiTUFHSUNfU0NST0xMQUJMRV9CWSIsImRvRmluZEVsZW1lbnRPckVscyIsInBhcmFtcyIsInN0cmF0ZWd5IiwidGVzdCIsInNlbGVjdG9yIiwiZWxlbWVudElkIiwiY29udGV4dCIsInVpYXV0b21hdG9yMiIsImp3cHJveHkiLCJjb21tYW5kIiwiQ3NzQ29udmVydGVyIiwib3B0cyIsImFwcFBhY2thZ2UiLCJ0b1VpQXV0b21hdG9yU2VsZWN0b3IiLCJtdWx0aXBsZSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jb21tYW5kcy9maW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDc3NDb252ZXJ0ZXIgZnJvbSAnLi4vY3NzLWNvbnZlcnRlcic7XG5cbmNvbnN0IGhlbHBlcnMgPSB7fTtcblxuLy8gd2Ugb3ZlcnJpZGUgdGhlIHhwYXRoIHNlYXJjaCBmb3IgdGhpcyBmaXJzdC12aXNpYmxlLWNoaWxkIHNlbGVjdG9yLCB3aGljaFxuLy8gbG9va3MgbGlrZSAvKltAZmlyc3RWaXNpYmxlPVwidHJ1ZVwiXVxuY29uc3QgTUFHSUNfRklSU1RfVklTX0NISUxEX1NFTCA9IC9cXC9cXCpcXFtAZmlyc3RWaXNpYmxlID89ID8oJ3xcIil0cnVlXFwxXFxdLztcblxuY29uc3QgTUFHSUNfU0NST0xMQUJMRV9TRUwgPSAvXFwvXFwvXFwqXFxbQHNjcm9sbGFibGUgPz0gPygnfFwiKXRydWVcXDFcXF0vO1xuY29uc3QgTUFHSUNfU0NST0xMQUJMRV9CWSA9ICduZXcgVWlTZWxlY3RvcigpLnNjcm9sbGFibGUodHJ1ZSknO1xuXG4vKipcbiAqIE92ZXJyaWRpbmcgaGVscGVycy5kb0ZpbmRFbGVtZW50T3JFbHMgZnVuY3Rpb25hbGl0eSBvZiBhcHBpdW0tYW5kcm9pZC1kcml2ZXIsXG4gKiB0aGlzLmVsZW1lbnQgaW5pdGlhbGl6ZWQgaW4gZmluZC5qcyBvZiBhcHBpdW0tYW5kcm9pZC1kcml2ZS5cbiAqL1xuaGVscGVycy5kb0ZpbmRFbGVtZW50T3JFbHMgPSBhc3luYyBmdW5jdGlvbiAocGFyYW1zKSB7XG4gIGlmIChwYXJhbXMuc3RyYXRlZ3kgPT09ICd4cGF0aCcgJiYgTUFHSUNfRklSU1RfVklTX0NISUxEX1NFTC50ZXN0KHBhcmFtcy5zZWxlY3RvcikpIHtcbiAgICBsZXQgZWxlbWVudElkID0gcGFyYW1zLmNvbnRleHQ7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudWlhdXRvbWF0b3IyLmp3cHJveHkuY29tbWFuZChgL2FwcGl1bS9lbGVtZW50LyR7ZWxlbWVudElkfS9maXJzdF92aXNpYmxlYCwgJ0dFVCcsIHt9KTtcbiAgfVxuICBpZiAocGFyYW1zLnN0cmF0ZWd5ID09PSAneHBhdGgnICYmIE1BR0lDX1NDUk9MTEFCTEVfU0VMLnRlc3QocGFyYW1zLnNlbGVjdG9yKSkge1xuICAgIHBhcmFtcy5zdHJhdGVneSA9ICctYW5kcm9pZCB1aWF1dG9tYXRvcic7XG4gICAgcGFyYW1zLnNlbGVjdG9yID0gTUFHSUNfU0NST0xMQUJMRV9CWTtcbiAgfVxuICBpZiAocGFyYW1zLnN0cmF0ZWd5ID09PSAnY3NzIHNlbGVjdG9yJykge1xuICAgIHBhcmFtcy5zdHJhdGVneSA9ICctYW5kcm9pZCB1aWF1dG9tYXRvcic7XG4gICAgcGFyYW1zLnNlbGVjdG9yID0gbmV3IENzc0NvbnZlcnRlcihwYXJhbXMuc2VsZWN0b3IsIHRoaXMub3B0cy5hcHBQYWNrYWdlKVxuICAgICAgLnRvVWlBdXRvbWF0b3JTZWxlY3RvcigpO1xuICB9XG4gIHJldHVybiBhd2FpdCB0aGlzLnVpYXV0b21hdG9yMi5qd3Byb3h5LmNvbW1hbmQoYC9lbGVtZW50JHtwYXJhbXMubXVsdGlwbGUgPyAncycgOiAnJ31gLCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5leHBvcnQgeyBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBoZWxwZXJzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBRUEsTUFBTUEsT0FBTyxHQUFHLENBQUMsQ0FBQztBQUFDO0FBSW5CLE1BQU1DLHlCQUF5QixHQUFHLHVDQUF1QztBQUV6RSxNQUFNQyxvQkFBb0IsR0FBRyx1Q0FBdUM7QUFDcEUsTUFBTUMsbUJBQW1CLEdBQUcsbUNBQW1DO0FBTS9ESCxPQUFPLENBQUNJLGtCQUFrQixHQUFHLGdCQUFnQkMsTUFBTSxFQUFFO0VBQ25ELElBQUlBLE1BQU0sQ0FBQ0MsUUFBUSxLQUFLLE9BQU8sSUFBSUwseUJBQXlCLENBQUNNLElBQUksQ0FBQ0YsTUFBTSxDQUFDRyxRQUFRLENBQUMsRUFBRTtJQUNsRixJQUFJQyxTQUFTLEdBQUdKLE1BQU0sQ0FBQ0ssT0FBTztJQUM5QixPQUFPLE1BQU0sSUFBSSxDQUFDQyxZQUFZLENBQUNDLE9BQU8sQ0FBQ0MsT0FBTyxDQUFFLG1CQUFrQkosU0FBVSxnQkFBZSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztFQUN6RztFQUNBLElBQUlKLE1BQU0sQ0FBQ0MsUUFBUSxLQUFLLE9BQU8sSUFBSUosb0JBQW9CLENBQUNLLElBQUksQ0FBQ0YsTUFBTSxDQUFDRyxRQUFRLENBQUMsRUFBRTtJQUM3RUgsTUFBTSxDQUFDQyxRQUFRLEdBQUcsc0JBQXNCO0lBQ3hDRCxNQUFNLENBQUNHLFFBQVEsR0FBR0wsbUJBQW1CO0VBQ3ZDO0VBQ0EsSUFBSUUsTUFBTSxDQUFDQyxRQUFRLEtBQUssY0FBYyxFQUFFO0lBQ3RDRCxNQUFNLENBQUNDLFFBQVEsR0FBRyxzQkFBc0I7SUFDeENELE1BQU0sQ0FBQ0csUUFBUSxHQUFHLElBQUlNLHFCQUFZLENBQUNULE1BQU0sQ0FBQ0csUUFBUSxFQUFFLElBQUksQ0FBQ08sSUFBSSxDQUFDQyxVQUFVLENBQUMsQ0FDdEVDLHFCQUFxQixFQUFFO0VBQzVCO0VBQ0EsT0FBTyxNQUFNLElBQUksQ0FBQ04sWUFBWSxDQUFDQyxPQUFPLENBQUNDLE9BQU8sQ0FBRSxXQUFVUixNQUFNLENBQUNhLFFBQVEsR0FBRyxHQUFHLEdBQUcsRUFBRyxFQUFDLEVBQUUsTUFBTSxFQUFFYixNQUFNLENBQUM7QUFDekcsQ0FBQztBQUFDLGVBR2FMLE9BQU87QUFBQSJ9